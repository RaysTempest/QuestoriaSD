<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Petualangan Pengetahuan Ultimate - Edisi Ekspansi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Fredoka+One&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f0f9ff;
            --text-color: #0c4a6e;
            --card-bg-color: #ffffff;
            --modal-bg-color: #ffffff;
            --border-color: #e0e7ff;
            --header-bg: rgba(255, 255, 255, 0.7);
            --locked-filter: grayscale(1);
            --pattern-url: url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><g fill="%23a8c5ff" fill-opacity="0.1"><circle cx="50" cy="50" r="5" /><circle cx="10" cy="10" r="2" /><circle cx="90" cy="90" r="3" /><circle cx="10" cy="90" r="4" /><circle cx="90" cy="10" r="2" /></g></svg>');
        }
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: var(--bg-color); 
            color: var(--text-color); 
            transition: background-color 0.5s, color 0.5s;
            background-image: var(--pattern-url);
        }
        .font-brand { font-family: 'Fredoka One', cursive; }
        .card-hover { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .card-hover:hover { transform: translateY(-10px) scale(1.05); box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1); }
        .screen, .modal-overlay { display: none; }
        .screen.active, .modal-overlay.active { display: flex; animation: fadeIn 0.5s ease-in-out forwards; }
        .avatar { width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; color: white; transition: transform 0.3s; }
        .avatar:hover { transform: scale(1.1); }
        .tts-button:hover, .hint-button:hover { color: #1d4ed8; background-color: #dbeafe; }
        .avatar-selection { cursor: pointer; border: 4px solid transparent; border-radius: 50%; transition: all 0.2s ease; position: relative; }
        .avatar-selection.selected { border-color: #2563eb; transform: scale(1.1); box-shadow: 0 0 15px rgba(37, 99, 235, 0.5); }
        .shop-item { cursor: pointer; border: 4px solid var(--border-color); border-radius: 1.5rem; transition: all 0.2s ease; position: relative; background-color: var(--card-bg-color); }
        .shop-item:hover { transform: scale(1.05); box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .shop-item.owned { border-color: #16a34a; }
        .shop-item.equipped { border-color: #2563eb; box-shadow: 0 0 20px rgba(37, 99, 235, 0.6); }
        .shop-item.locked::after { content: 'ğŸ”’'; position: absolute; top: 8px; right: 8px; font-size: 1.5rem; background: rgba(0,0,0,0.4); color: white; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; }
        .price-tag { position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%); background: #fbbf24; color: #78350f; font-weight: bold; padding: 2px 10px; border-radius: 99px; font-size: 0.9rem; border: 2px solid white; }
        .point-animation { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 2.5rem; font-weight: bold; color: #f59e0b; z-index: 100; animation: floatUp 1.5s ease-out forwards; pointer-events: none; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); }
        .mascot-tip { position: fixed; bottom: 20px; left: 20px; background-color: white; padding: 15px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); z-index: 100; display: flex; align-items: center; max-width: 300px; animation: slideInUp 0.5s ease-out; }
        .bonus-world-badge { position: absolute; top: -10px; right: -10px; background-color: #ef4444; color: white; font-weight: bold; font-size: 0.75rem; padding: 2px 8px; border-radius: 99px; transform: rotate(15deg); animation: pulse 1.5s infinite; }
        .event-banner { background: linear-gradient(45deg, #f87171, #fb923c); color: white; text-shadow: 1px 1px 2px rgba(0,0,0,0.3); animation: pulse-bg 3s infinite; }
        @keyframes pulse-bg { 0% { background-color: #f87171; } 50% { background-color: #fb923c; } 100% { background-color: #f87171; } }

        body.dark {
            --bg-color: #0b1120;
            --text-color: #d1d5db;
            --card-bg-color: #1f2937;
            --modal-bg-color: #111827;
            --border-color: #374151;
            --header-bg: rgba(31, 41, 55, 0.7);
            --locked-filter: grayscale(1) invert(0.75);
            --pattern-url: url('data:image/svg+xml;utf8,<svg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><g fill="%234b5563" fill-opacity="0.2"><circle cx="50" cy="50" r="5" /><circle cx="10" cy="10" r="2" /><circle cx="90" cy="90" r="3" /><circle cx="10" cy="90" r="4" /><circle cx="90" cy="10" r="2" /></g></svg>');
        }
        body.high-contrast {
             --bg-color: #000000;
             --text-color: #ffffff;
             --card-bg-color: #1a1a1a;
             --border-color: #ffffff;
        }
        .font-size-small { font-size: 0.875rem; }
        .font-size-normal { font-size: 1rem; }
        .font-size-large { font-size: 1.125rem; }
        
        .star-animation { animation: star-pop 0.5s ease-in-out; }
        @keyframes star-pop { 0% { transform: scale(0); } 80% { transform: scale(1.5); } 100% { transform: scale(1); } }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes scaleUp { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes floatUp { from { opacity: 1; transform: translate(-50%, -50%) scale(1); } to { opacity: 0; transform: translate(-50%, -250%) scale(1.5); } }
        @keyframes slideInUp { from { transform: translateY(100px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes pulse { 0%, 100% { transform: scale(1) rotate(15deg); } 50% { transform: scale(1.1) rotate(15deg); } }
    </style>
</head>
<body class="text-gray-800">
    <audio id="background-music" loop>
        <source src="https://www.chosic.com/wp-content/uploads/2021/04/purrple-cat-wondering.mp3" type="audio/mpeg">
    </audio>

    <div id="app" class="min-h-screen flex flex-col items-center justify-center p-4">

        <div id="loading-screen" class="screen active text-center flex-col w-full">
            <h1 class="font-brand text-5xl md:text-7xl text-sky-700 mb-4">Petualangan Pengetahuan</h1>
            <div class="animate-pulse text-2xl text-gray-600">Mempersiapkan Petualangan...</div>
        </div>
        
        <div id="user-selection-screen" class="screen text-center flex-col w-full max-w-4xl">
            <h1 class="font-brand text-5xl md:text-7xl text-sky-700 mb-4">Petualangan Pengetahuan</h1>
            <p class="text-lg md:text-xl text-gray-600 mb-8">Siapa yang akan berpetualang hari ini?</p>
            <div id="user-list-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 mb-8"></div>
            <button id="add-new-user-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-4 px-8 rounded-full shadow-lg transform hover:scale-110 transition-transform duration-300 text-xl">+ Tambah Pengguna Baru</button>
        </div>

        <div id="name-entry-screen" class="screen flex-col w-full max-w-lg">
            <div class="bg-white p-8 rounded-3xl shadow-2xl w-full text-center">
                 <h1 class="font-brand text-4xl text-sky-700 mb-2">Buat Profil Baru</h1>
                 <p class="text-gray-600 mb-6">Masukkan nama dan pilih avatarmu!</p>
                 <input type="text" id="player-name-input" placeholder="Contoh: Budi" class="text-center text-2xl p-4 border-2 border-sky-300 rounded-xl shadow-inner focus:border-orange-500 focus:ring-orange-500 mb-6 w-full">
                 <p class="font-semibold mb-4">Pilih Avatar:</p>
                 <div id="avatar-selection-container" class="flex justify-center gap-4 mb-8">
                    </div>
                 <div class="flex gap-4">
                    <button id="cancel-new-user-btn" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-3 px-6 rounded-xl shadow-md transition-transform duration-300">Batal</button>
                    <button id="next-to-level-btn" class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition-transform duration-300 disabled:bg-gray-400" disabled>Lanjut</button>
                 </div>
            </div>
        </div>
        
        <div id="jenjang-screen" class="screen text-center flex-col w-full max-w-3xl">
            <h1 class="font-brand text-4xl md:text-6xl text-sky-700 mb-2">Pilih Jenjangmu</h1>
            <p class="text-lg md:text-xl text-gray-600 mb-8" id="jenjang-prompt-name"></p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 w-full max-w-2xl">
                <button data-jenjang="sd" class="jenjang-btn bg-green-500 hover:bg-green-600 text-white font-bold py-6 px-8 rounded-2xl shadow-lg transform hover:scale-105 transition-transform duration-300 text-2xl"><span class="text-4xl block mb-2">ğŸ“</span> SD</button>
                <button data-jenjang="smp" class="jenjang-btn bg-blue-500 hover:bg-blue-600 text-white font-bold py-6 px-8 rounded-2xl shadow-lg transform hover:scale-105 transition-transform duration-300 text-2xl"><span class="text-4xl block mb-2">ğŸ“š</span> SMP</button>
                <button data-jenjang="sma" class="jenjang-btn bg-purple-500 hover:bg-purple-600 text-white font-bold py-6 px-8 rounded-2xl shadow-lg transform hover:scale-105 transition-transform duration-300 text-2xl"><span class="text-4xl block mb-2">ğŸ”¬</span> SMA</button>
                <button data-jenjang="kuliah" class="jenjang-btn bg-red-500 hover:bg-red-600 text-white font-bold py-6 px-8 rounded-2xl shadow-lg transform hover:scale-105 transition-transform duration-300 text-2xl"><span class="text-4xl block mb-2">ğŸ’¼</span> Mahasiswa</button>
            </div>
        </div>

        <div id="map-screen" class="screen w-full max-w-7xl mx-auto flex-col">
            <header class="flex flex-wrap justify-between items-center mb-6 px-4 gap-4 w-full backdrop-blur-sm p-4 rounded-2xl shadow" style="background-color: var(--header-bg)">
                 <div class="flex items-center gap-4">
                    <div id="user-avatar-header" class="avatar w-16 h-16 cursor-pointer" title="Ganti Pengguna"></div>
                    <div>
                        <h2 class="font-brand text-2xl md:text-4xl text-sky-800" id="welcome-message"></h2>
                        <h3 class="font-semibold text-lg text-amber-700" id="user-title-display"></h3>
                        <div class="flex items-center gap-4">
                            <p class="text-md md:text-lg font-bold text-amber-600" id="points-display"></p>
                            <p class="text-md md:text-lg font-bold text-red-500" id="streak-display" title="Bonus login beruntun!"></p>
                        </div>
                    </div>
                 </div>
                 <div class="flex items-center gap-2 flex-wrap justify-center">
                    <button id="shop-hub-btn" class="bg-violet-500 hover:bg-violet-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:scale-105">ğŸ›ï¸ Toko</button>
                    <button id="daily-mission-btn" class="bg-cyan-500 hover:bg-cyan-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:scale-105">ğŸ¯ Misi</button>
                    <button id="leaderboard-btn" class="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:scale-105">ğŸ¥‡ Peringkat</button>
                    <button id="achievements-btn" class="bg-amber-500 hover:bg-amber-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:scale-105">ğŸ† Prestasi</button>
                    <button id="settings-btn" class="bg-gray-700 hover:bg-gray-800 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:scale-105">âš™ï¸</button>
                </div>
            </header>
            <div id="event-banner-container" class="w-full mb-4 px-2"></div>
            <div class="w-full mb-4 px-2">
                 <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div class="bg-white/60 p-3 rounded-lg shadow">
                         <h3 class="font-bold text-center text-sky-800">ğŸ“š Kata Hari Ini</h3>
                         <p id="word-of-the-day" class="text-center text-sm"></p>
                    </div>
                    <div class="bg-white/60 p-3 rounded-lg shadow flex items-center justify-around">
                        <button id="review-mode-btn" class="bg-teal-500 hover:bg-teal-600 text-white font-semibold py-2 px-3 rounded-lg text-sm">ğŸ” Favorit</button>
                        <button id="timed-challenge-btn" class="bg-rose-500 hover:bg-rose-600 text-white font-semibold py-2 px-3 rounded-lg text-sm">â±ï¸ Tantangan Waktu</button>
                    </div>
                </div>
                <input type="text" id="search-bar" placeholder="ğŸ” Cari dunia atau topik..." class="w-full p-3 rounded-lg border-2 border-sky-200 shadow-sm">
            </div>
            <div id="dunia-container" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6 md:gap-8 w-full"></div>
        </div>
        
        <div id="submateri-screen" class="screen w-full max-w-5xl mx-auto flex-col">
             <div class="flex justify-between items-center w-full mb-10">
                <div></div>
                <h2 id="submateri-title" class="font-brand text-4xl md:text-5xl text-center"></h2>
                <div class="flex items-center gap-2">
                    <label for="progress-tree-toggle" class="text-sm font-semibold">Pohon</label>
                    <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                        <input type="checkbox" name="progress-tree-toggle" id="progress-tree-toggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                        <label for="progress-tree-toggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                    </div>
                </div>
            </div>
             <div id="submateri-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
             <div class="text-center mt-8"><button id="back-to-worlds-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105">&larr; Kembali ke Peta Dunia</button></div>
       </div>

       <div id="materi-screen" class="screen w-full max-w-4xl mx-auto bg-white p-6 md:p-10 rounded-2xl shadow-2xl flex-col">
           <div id="materi-content" class="w-full"></div>
            <div class="text-center mt-8 w-full"><button id="back-to-submateri-btn" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transform hover:scale-105">&larr; Kembali Pilih Materi</button></div>
       </div>
    </div>

    <div id="avatar-shop-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-70 items-center justify-center p-4 z-50">
        <div class="modal-content bg-white rounded-2xl p-8 shadow-2xl w-full max-w-2xl scale-up">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-brand text-3xl text-violet-600">ğŸ‘• Toko Avatar ğŸ‘•</h3>
                <div class="font-bold text-amber-600 text-xl bg-amber-100 px-4 py-2 rounded-full" id="shop-points-display"></div>
            </div>
            <div id="avatar-shop-container" class="grid grid-cols-3 md:grid-cols-4 gap-6 max-h-80 overflow-y-auto p-4 bg-gray-50 rounded-lg">
                </div>
            <button id="close-avatar-shop-btn" class="mt-6 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-full shadow-lg w-full">Tutup</button>
        </div>
    </div>
    
    <div id="shop-hub-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-70 items-center justify-center p-4 z-50">
        <div class="modal-content bg-white rounded-2xl p-8 shadow-2xl w-full max-w-2xl scale-up">
            <h3 class="font-brand text-4xl text-violet-600 text-center mb-6">Pusat Perbelanjaan</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-center">
                <div id="open-avatar-shop" class="p-6 bg-rose-100 rounded-2xl cursor-pointer card-hover border-2 border-rose-300">
                    <div class="text-5xl mb-2">ğŸ‘•</div>
                    <h4 class="font-bold text-xl text-rose-800">Toko Avatar</h4>
                    <p class="text-sm text-rose-600">Ganti penampilanmu!</p>
                </div>
                <div id="open-customization-shop" class="p-6 bg-sky-100 rounded-2xl cursor-pointer card-hover border-2 border-sky-300">
                    <div class="text-5xl mb-2">ğŸ¨</div>
                    <h4 class="font-bold text-xl text-sky-800">Warung Kustomisasi</h4>
                    <p class="text-sm text-sky-600">Ubah tema & warna.</p>
                </div>
                <div id="open-powerup-shop" class="p-6 bg-amber-100 rounded-2xl cursor-pointer card-hover border-2 border-amber-300">
                    <div class="text-5xl mb-2">âš¡</div>
                    <h4 class="font-bold text-xl text-amber-800">Pasar Kekuatan</h4>
                    <p class="text-sm text-amber-600">Beli item bantuan.</p>
                </div>
                <div id="open-mascot-shop" class="p-6 bg-emerald-100 rounded-2xl cursor-pointer card-hover border-2 border-emerald-300">
                    <div class="text-5xl mb-2">ğŸ¦‰</div>
                    <h4 class="font-bold text-xl text-emerald-800">Butik Cendekia</h4>
                    <p class="text-sm text-emerald-600">Hiasi maskotmu.</p>
                </div>
                 <div id="open-gacha-shop" class="md:col-span-2 p-6 bg-purple-100 rounded-2xl cursor-pointer card-hover border-2 border-purple-300">
                    <div class="text-5xl mb-2">ğŸ</div>
                    <h4 class="font-bold text-xl text-purple-800">Peti Harta Karun</h4>
                    <p class="text-sm text-purple-600">Dapatkan power-up acak!</p>
                </div>
            </div>
            <button id="close-shop-hub-btn" class="mt-8 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-full w-full">Tutup</button>
        </div>
    </div>
    
    <div id="generic-shop-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-70 items-center justify-center p-4 z-50">
        <div class="modal-content bg-white rounded-2xl p-8 shadow-2xl w-full max-w-3xl scale-up">
            <div class="flex justify-between items-center mb-6">
                <h3 id="generic-shop-title" class="font-brand text-3xl">Nama Toko</h3>
                <div class="font-bold text-amber-600 text-xl bg-amber-100 px-4 py-2 rounded-full" id="generic-shop-points"></div>
            </div>
            <div id="generic-shop-container" class="grid grid-cols-2 md:grid-cols-3 gap-4 max-h-80 overflow-y-auto p-4 bg-gray-50 rounded-lg">
                </div>
            <button class="generic-shop-close-btn mt-6 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-full shadow-lg w-full">Tutup</button>
        </div>
    </div>
    
    <div id="settings-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-70 items-center justify-center p-4 z-50">
        <div class="modal-content bg-white rounded-2xl p-6 shadow-2xl w-full max-w-md scale-up">
            <h3 class="font-brand text-3xl text-sky-800 text-center mb-4">Pengaturan</h3>
            <div class="w-full">
                <div class="border-b border-gray-200">
                    <nav class="-mb-px flex space-x-4" aria-label="Tabs">
                        <button class="settings-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm border-sky-500 text-sky-600" data-tab="general">Umum</button>
                        <button class="settings-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="appearance">Tampilan</button>
                        <button class="settings-tab whitespace-nowrap py-3 px-1 border-b-2 font-medium text-sm border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300" data-tab="account">Akun</button>
                    </nav>
                </div>
                <div id="settings-tab-content" class="py-4">
                    <div class="settings-tab-pane active" id="tab-general">
                        <div class="flex justify-between items-center p-3 bg-gray-100 rounded-lg mb-3">
                            <label for="sound-toggle" class="font-semibold">Efek Suara</label>
                            <button id="sound-toggle" class="text-2xl">ğŸ”Š</button>
                        </div>
                         <div class="flex justify-between items-center p-3 bg-gray-100 rounded-lg mb-3">
                            <label for="music-toggle" class="font-semibold">Musik Latar</label>
                            <button id="music-toggle" class="text-2xl">ğŸµ</button>
                        </div>
                        <div class="flex justify-between items-center p-3 bg-gray-100 rounded-lg">
                            <label for="zen-mode-toggle" class="font-semibold">Mode Zen (Tanpa Skor)</label>
                            <button id="zen-mode-toggle" class="text-2xl">ğŸ§˜</button>
                        </div>
                    </div>
                    <div class="settings-tab-pane" id="tab-appearance" style="display: none;">
                         <span class="block font-semibold mb-2">Tema Tampilan</span>
                         <div class="flex gap-2" id="theme-selector">
                             <button data-theme="light" class="w-full p-2 border-2 rounded-lg font-semibold">â˜€ï¸ Terang</button>
                             <button data-theme="dark" class="w-full p-2 border-2 rounded-lg font-semibold">ğŸŒ™ Gelap</button>
                             <button data-theme="high-contrast" class="w-full p-2 border-2 rounded-lg font-semibold"> ĞºĞ¾Ğ½Ñ‚Ñ€Ğ°Ñ</button>
                         </div>
                         <span class="block font-semibold mt-4 mb-2">Ukuran Font</span>
                         <div class="flex gap-2" id="font-size-selector">
                             <button data-size="small" class="w-full p-2 border-2 rounded-lg font-semibold">Kecil</button>
                             <button data-size="normal" class="w-full p-2 border-2 rounded-lg font-semibold">Normal</button>
                             <button data-size="large" class="w-full p-2 border-2 rounded-lg font-semibold">Besar</button>
                         </div>
                    </div>
                    <div class="settings-tab-pane" id="tab-account" style="display: none;">
                        <div class="space-y-4">
                             <div>
                                <label for="edit-name-input" class="block font-semibold mb-2">Ganti Nama Pengguna</label>
                                <div class="flex gap-2">
                                    <input type="text" id="edit-name-input" class="w-full p-2 border-2 border-gray-300 rounded-lg">
                                    <button id="save-name-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg">Simpan</button>
                                </div>
                            </div>
                            <div>
                                <label for="change-jenjang-select" class="block font-semibold mb-2">Ganti Jenjang</label>
                                <select id="change-jenjang-select" class="w-full p-2 border-2 border-gray-300 rounded-lg">
                                    <option value="sd">SD</option><option value="smp">SMP</option><option value="sma">SMA</option><option value="kuliah">Mahasiswa</option>
                                </select>
                            </div>
                             <hr/>
                            <button id="reset-progress-btn" class="w-full text-left p-3 bg-red-100 hover:bg-red-200 text-red-700 rounded-lg font-bold">ğŸ—‘ï¸ Reset Progres Pengguna Ini</button>
                        </div>
                    </div>
                </div>
            </div>
            <button id="close-settings-btn" class="mt-4 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-full w-full">Tutup</button>
        </div>
    </div>
    
    <div id="daily-bonus-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-70 items-center justify-center p-4 z-50">
        <div class="modal-content bg-white rounded-2xl p-8 shadow-2xl w-full max-w-sm text-center scale-up">
            <h3 class="font-brand text-3xl text-yellow-500">Bonus Login Harian!</h3>
            <div class="text-7xl my-4 animate-bounce">ğŸ’°</div>
            <p class="text-gray-600 text-lg mb-2">Kamu mendapatkan <strong class="text-amber-600" id="daily-bonus-amount">50 Poin</strong>!</p>
            <p class="text-gray-600 text-lg mb-4" id="daily-streak-bonus-text"></p>
            <button id="close-daily-bonus-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-full w-full">Asyik!</button>
        </div>
    </div>

    <div id="confirm-reset-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-70 items-center justify-center p-4 z-50">
        <div class="modal-content bg-white rounded-2xl p-8 shadow-2xl w-full max-w-sm text-center scale-up">
            <h3 class="font-bold text-2xl text-red-700">PERINGATAN!</h3>
            <p class="text-gray-600 my-4">Yakin ingin mereset progres untuk <strong id="reset-username-confirm"></strong>? Semua poin & lencana akan hilang.</p>
            <div class="flex justify-center gap-4 mt-6">
                <button id="cancel-reset-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-full">Batal</button>
                <button id="confirm-reset-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-full">Ya, Yakin</button>
            </div>
        </div>
    </div>
    <div id="fun-fact-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 items-center justify-center p-4 z-50">
        <div class="modal-content bg-white rounded-2xl p-8 shadow-2xl w-full max-w-md text-center scale-up">
            <div id="mascot-container" class="w-24 h-24 mx-auto mb-4">
                 <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><g><path d="M50,15 C25,15 10,35 10,55 C10,80 25,95 50,95 C75,95 90,80 90,55 C90,35 75,15 50,15 Z" fill="#4CAF50"/><path d="M35,45 C40,40 50,40 55,45 C60,50 60,60 55,65 L45,65 C40,60 40,50 35,45 Z" fill="#388E3C" transform="translate(-15, 0)"/><path d="M65,45 C60,40 50,40 45,45 C40,50 40,60 45,65 L55,65 C60,60 60,50 65,45 Z" fill="#388E3C" transform="translate(15, 0)"/><circle cx="32" cy="52" r="18" fill="white"/><circle cx="68" cy="52" r="18" fill="white"/><circle cx="33" cy="53" r="8" fill="black"/><circle cx="67" cy="53" r="8" fill="black"/><path d="M50,65 C55,75 45,75 50,65 L52,70 L48,70 Z" fill="#FFC107"/><path d="M20,15 Q30,5 40,15" stroke="#388E3C" stroke-width="4" fill="none" stroke-linecap="round"/><path d="M80,15 Q70,5 60,15" stroke="#388E3C" stroke-width="4" fill="none" stroke-linecap="round"/></g></svg>
            </div>
            <h3 class="font-brand text-2xl text-sky-700">Fakta Seru!</h3><p id="fun-fact-text" class="text-gray-700 my-4"></p><button id="close-fun-fact-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-full shadow-lg">Lanjut!</button>
        </div>
    </div>
    <div id="achievements-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 items-center justify-center p-4 z-50">
        <div class="modal-content bg-white rounded-2xl p-8 shadow-2xl w-full max-w-lg scale-up">
            <div class="flex justify-between items-center mb-4">
                 <h3 class="font-brand text-3xl text-amber-600 text-center">ğŸ† Prestasiku ğŸ†</h3>
                 <button id="share-progress-btn" title="Bagikan Prestasi" class="bg-blue-500 hover:bg-blue-600 text-white font-bold p-2 rounded-full shadow-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path><polyline points="16 6 12 2 8 6"></polyline><line x1="12" y1="2" x2="12" y2="15"></line></svg>
                 </button>
            </div>
            <div id="achievements-list" class="space-y-3 max-h-80 overflow-y-auto"></div><button id="close-achievements-btn" class="mt-6 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-full shadow-lg w-full">Tutup</button>
        </div>
    </div>
    <div id="leaderboard-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 items-center justify-center p-4 z-50">
        <div class="modal-content bg-white rounded-2xl p-8 shadow-2xl w-full max-w-lg scale-up">
            <h3 class="font-brand text-3xl text-yellow-600 text-center mb-4">ğŸ¥‡ Papan Peringkat ğŸ¥‡</h3>
            <div id="leaderboard-list" class="space-y-2 max-h-80 overflow-y-auto"></div>
            <button id="close-leaderboard-btn" class="mt-6 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-full shadow-lg w-full">Tutup</button>
        </div>
    </div>
    <div id="daily-mission-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 items-center justify-center p-4 z-50">
        <div class="modal-content bg-white rounded-2xl p-8 shadow-2xl w-full max-w-md text-center scale-up">
            <h3 class="font-brand text-3xl text-cyan-600 text-center mb-4">ğŸ¯ Misi Harian ğŸ¯</h3>
            <p id="daily-mission-text" class="text-gray-700 text-lg my-4"></p>
            <div id="mission-progress-container" class="w-full bg-gray-200 rounded-full h-6 my-4">
                <div id="mission-progress-bar" class="bg-cyan-500 h-6 rounded-full text-white flex items-center justify-center text-sm font-bold" style="width: 0%;">0%</div>
            </div>
            <button id="claim-mission-reward-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full shadow-lg w-full disabled:bg-gray-400 disabled:cursor-not-allowed">Klaim Hadiah</button>
            <button id="close-daily-mission-btn" class="mt-4 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-full shadow-lg w-full">Tutup</button>
        </div>
    </div>
    <div id="certificate-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 items-center justify-center p-4 z-50">
        <div class="modal-content bg-slate-50 rounded-2xl p-8 shadow-2xl w-full max-w-2xl scale-up border-8 border-amber-400" style="background-image: url('https://www.transparenttextures.com/patterns/light-paper-fibers.png');">
            <div class="text-center">
                 <h2 class="font-brand text-2xl text-gray-500">Sertifikat Petualang Pengetahuan</h2>
                 <h1 class="font-brand text-5xl text-sky-700 my-4" id="certificate-name"></h1>
                 <p class="text-lg text-gray-600">Telah dengan gemilang menyelesaikan seluruh tantangan di jenjangnya!</p>
                 <div class="my-6 text-5xl">ğŸ‰ ğŸŒŸ ğŸ“ ğŸŒŸ ğŸ‰</div>
                 <div class="flex gap-4 justify-center">
                    <button id="share-certificate-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-8 rounded-full shadow-lg">Bagikan</button>
                    <button id="close-certificate-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-8 rounded-full shadow-lg">Luar Biasa!</button>
                 </div>
            </div>
        </div>
    </div>
     <div id="timed-challenge-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-70 items-center justify-center p-4 z-50">
        <div class="modal-content bg-white rounded-2xl p-8 shadow-2xl w-full max-w-xl text-center scale-up">
            <h3 class="font-brand text-3xl text-rose-600">â±ï¸ Tantangan Waktu â±ï¸</h3>
            <div id="challenge-timer" class="my-4 text-2xl font-bold"></div>
            <div id="challenge-question-area"></div>
            <div id="challenge-feedback" class="mt-4 font-bold"></div>
            <button id="close-timed-challenge-btn" class="hidden mt-4 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-full w-full">Tutup</button>
        </div>
    </div>
     <div id="stats-modal" class="modal-overlay fixed inset-0 bg-black bg-opacity-60 items-center justify-center p-4 z-50">
        <div class="modal-content bg-white rounded-2xl p-8 shadow-2xl w-full max-w-md scale-up">
            <h3 class="font-brand text-3xl text-sky-800 text-center mb-4" id="stats-username">Statistik Budi</h3>
            <div id="stats-content" class="space-y-3"></div>
            <div class="mt-4 flex gap-2">
                <button id="gift-player-btn" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg">ğŸ Kirim Hadiah</button>
                <button id="challenge-player-btn" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg">âš”ï¸ Tantang</button>
            </div>
            <button id="close-stats-btn" class="mt-2 bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-6 rounded-full w-full">Tutup</button>
        </div>
    </div>

    <div id="point-animation-container"></div>
    <div id="mascot-tip-container"></div>

    <script>
        // --- DATA APLIKASI ---

        // Database Avatar
        const avatarData = {
            'avatar1': { svg: `<svg viewBox="0 0 36 36" fill="none" role="img" xmlns="http://www.w3.org/2000/svg" width="80" height="80"><mask id="mask__beam" maskUnits="userSpaceOnUse" x="0" y="0" width="36" height="36"><rect width="36" height="36" fill="#FFFFFF" rx="72"></rect></mask><g mask="url(#mask__beam)"><rect width="36" height="36" fill="#75d475"></rect><rect x="0" y="0" width="36" height="36" transform="translate(4 4) rotate(268 18 18) scale(1.2)" fill="#248038" rx="36"></rect><g transform="translate(-4 -1) rotate(8 18 18)"><path d="M15 21c2 1 4 1 6 0" stroke="#000000" fill="none" stroke-linecap="round"></path><rect x="10" y="14" width="1.5" height="2" rx="1" stroke="none" fill="#000000"></rect><rect x="24" y="14" width="1.5" height="2" rx="1" stroke="none" fill="#000000"></rect></g></g></svg>`, price: 0, isStarter: true },
            'avatar2': { svg: `<svg viewBox="0 0 36 36" fill="none" role="img" xmlns="http://www.w3.org/2000/svg" width="80" height="80"><mask id="mask__beam" maskUnits="userSpaceOnUse" x="0" y="0" width="36" height="36"><rect width="36" height="36" fill="#FFFFFF" rx="72"></rect></mask><g mask="url(#mask__beam)"><rect width="36" height="36" fill="#84b6e0"></rect><rect x="0" y="0" width="36" height="36" transform="translate(0 0) rotate(329 18 18) scale(1.2)" fill="#25648a" rx="36"></rect><g transform="translate(0 5) rotate(-9 18 18)"><path d="M15 21c2 1 4 1 6 0" stroke="#FFFFFF" fill="none" stroke-linecap="round"></path><rect x="14" y="14" width="1.5" height="2" rx="1" stroke="none" fill="#FFFFFF"></rect><rect x="20" y="14" width="1.5" height="2" rx="1" stroke="none" fill="#FFFFFF"></rect></g></g></svg>`, price: 0, isStarter: true },
            'avatar3': { svg: `<svg viewBox="0 0 36 36" fill="none" role="img" xmlns="http://www.w3.org/2000/svg" width="80" height="80"><mask id="mask__beam" maskUnits="userSpaceOnUse" x="0" y="0" width="36" height="36"><rect width="36" height="36" fill="#f0c38e"></rect></mask><g mask="url(#mask__beam)"><rect width="36" height="36" fill="#f0c38e"></rect><rect x="0" y="0" width="36" height="36" transform="translate(8 -6) rotate(114 18 18) scale(1.2)" fill="#a07d58" rx="36"></rect><g transform="translate(4 -4) rotate(-4 18 18)"><path d="M13,21 a8,8 0 0,0 10,0" fill="#000000"></path><rect x="14" y="14" width="1.5" height="2" rx="1" stroke="none" fill="#000000"></rect><rect x="20" y="14" width="1.5" height="2" rx="1" stroke="none" fill="#000000"></rect></g></g></svg>`, price: 0, isStarter: true },
            'avatar4': { svg: `<svg viewBox="0 0 36 36" fill="none" role="img" xmlns="http://www.w3.org/2000/svg" width="80" height="80"><mask id="mask__beam" maskUnits="userSpaceOnUse" x="0" y="0" width="36" height="36"><rect width="36" height="36" fill="#FFFFFF" rx="72"></rect></mask><g mask="url(#mask__beam)"><rect width="36" height="36" fill="#e0a3a3"></rect><rect x="0" y="0" width="36" height="36" transform="translate(-4 -4) rotate(278 18 18) scale(1.1)" fill="#9c5656" rx="64"></rect><g transform="translate(-4 0) rotate(8 18 18)"><path d="M15 19c2 1 4 1 6 0" stroke="#FFFFFF" fill="none" stroke-linecap="round"></path><rect x="11" y="14" width="1.5" height="2" rx="1" stroke="none" fill="#FFFFFF"></rect><rect x="23" y="14" width="1.5" height="2" rx="1" stroke="none" fill="#FFFFFF"></rect></g></g></svg>`, price: 0, isStarter: true },
            'avatar5': { svg: `<svg width="80" height="80" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><mask id="mask0_33_33" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="36" height="36"><circle cx="18" cy="18" r="18" fill="#D9D9D9"/></mask><g mask="url(#mask0_33_33)"><rect width="36" height="36" fill="#F2D4A7"/><ellipse cx="18" cy="33.5" rx="18" ry="13.5" fill="#3B2219"/><path d="M-5 13C-5 5.8203 0.8203 -1.13379e-06 8 -1.13379e-06V13H-5Z" fill="#6A463A"/><path d="M41 13C41 5.8203 35.1797 -1.13379e-06 28 -1.13379e-06V13H41Z" fill="#6A463A"/><rect x="11" y="16" width="3" height="4" rx="1.5" fill="white"/><rect x="22" y="16" width="3" height="4" rx="1.5" fill="white"/><path d="M13 23C13 23 15 25 18 25C21 25 23 23 23 23" stroke="white" stroke-width="2" stroke-linecap="round"/></g></svg>`, price: 200 },
            'avatar6': { svg: `<svg width="80" height="80" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><mask id="mask0_33_41" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="36" height="36"><circle cx="18" cy="18" r="18" fill="white"/></mask><g mask="url(#mask0_33_41)"><rect width="36" height="36" fill="#A7CFF2"/><rect x="11" y="16" width="3" height="4" rx="1.5" fill="#223B4E"/><rect x="22" y="16" width="3" height="4" rx="1.5" fill="#223B4E"/><path d="M13 23L23 23" stroke="#223B4E" stroke-width="2" stroke-linecap="round"/><path d="M11 12L7 9" stroke="#223B4E" stroke-width="2" stroke-linecap="round"/><path d="M25 12L29 9" stroke="#223B4E" stroke-width="2" stroke-linecap="round"/></g></svg>`, price: 250 },
            'avatar7': { svg: `<svg width="80" height="80" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><mask id="mask0_33_49" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="36" height="36"><circle cx="18" cy="18" r="18" fill="white"/></mask><g mask="url(#mask0_33_49)"><rect width="36" height="36" fill="#F2A7A7"/><path d="M36 18C36 8.05887 27.9411 0 18 0C8.05887 0 0 8.05887 0 18H36Z" fill="#D16F6F"/><rect x="11" y="16" width="3" height="4" rx="1.5" fill="#5A2E2E"/><rect x="22" y="16" width="3" height="4" rx="1.5" fill="#5A2E2E"/><path d="M15 25C15 25 16.5 23 18 23C19.5 23 21 25 21 25" stroke="#5A2E2E" stroke-width="2" stroke-linecap="round"/></g></svg>`, price: 300 },
            'avatar8': { svg: `<svg width="80" height="80" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="36" height="36" rx="18" fill="#BEBEBE"/><rect x="10" y="15" width="4" height="6" fill="#1E1E1E"/><rect x="22" y="15" width="4" height="6" fill="#1E1E1E"/><path d="M10 25L26 25" stroke="#1E1E1E" stroke-width="2"/><path d="M4 11L10 5" stroke="#1E1E1E" stroke-width="2" stroke-linecap="round"/><path d="M32 11L26 5" stroke="#1E1E1E" stroke-width="2" stroke-linecap="round"/></svg>`, price: 500 },
            'avatar_astronaut': { svg: `<svg width="80" height="80" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><g clip-path="url(#clip0_803_2)"><rect width="36" height="36" rx="18" fill="white"/><rect x="-5" y="15" width="46" height="27" fill="#474D54"/><ellipse cx="18" cy="18" rx="13" ry="12" fill="#75D4EB"/><path d="M18 18L10 18" stroke="white" stroke-width="2" stroke-linecap="round"/><ellipse cx="18" cy="18" rx="10" ry="9" fill="#292D32"/><path d="M22 17C22.5931 18.0538 21.3333 19.3333 20 19C18.6667 18.6667 19.2931 16.9462 20 17C20.7069 17.0538 21.4069 15.9462 22 17Z" fill="white" fill-opacity="0.5"/></g></svg>`, price: 750, name: "Astronot" },
            'avatar_knight': { svg: `<svg width="80" height="80" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="36" height="36" rx="18" fill="#E0E0E0"/><path d="M7 16H29V25H7V16Z" fill="#BDBDBD"/><path d="M11 10H25L29 16H7L11 10Z" fill="#BDBDBD"/><rect x="17" y="18" width="2" height="5" fill="#424242"/><path d="M11 10L18 4L25 10" stroke="#EF5350" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>`, price: 800, name: "Ksatria Baja" },
            'avatar_wizard': { svg: `<svg width="80" height="80" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="36" height="36" rx="18" fill="#7E57C2"/><path d="M18 4L8 28H28L18 4Z" fill="#5E35B1"/><circle cx="18" cy="18" r="2" fill="#FDD835"/><path d="M16 18L10 16" stroke="#FDD835" stroke-width="1.5" stroke-linecap="round"/><path d="M20 18L26 16" stroke="#FDD835" stroke-width="1.5" stroke-linecap="round"/><path d="M18 20V26" stroke="#FDD835" stroke-width="1.5" stroke-linecap="round"/></svg>`, price: 850, name: "Penyihir Cahaya" },
            'avatar_garuda': { svg: `<svg width="80" height="80" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="36" height="36" rx="18" fill="#FFC107"/><path d="M18 14C12 14 8 20 8 20H28C28 20 24 14 18 14Z" fill="#F57F17"/><path d="M18 24V18" stroke="#795548" stroke-width="2"/><circle cx="14" cy="18" r="2" fill="black"/><circle cx="22" cy="18" r="2" fill="black"/></svg>`, price: 2000, name: "Garuda Emas" },
            'avatar_cyborg': { svg: `<svg width="80" height="80" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 0C8.05888 0 0 8.05888 0 18C0 27.9411 8.05888 36 18 36V0Z" fill="#84b6e0"/><path d="M18 0C27.9411 0 36 8.05888 36 18C36 27.9411 27.9411 36 18 36V0Z" fill="#BDBDBD"/><rect x="10" y="14" width="1.5" height="2" rx="1" fill="white"/><rect x="24" y="14" width="2" height="4" rx="1" fill="#FF5252"/></svg>`, price: 1300, name: "Cyborg" },
            'avatar_detective': { svg: `<svg width="80" height="80" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="36" height="36" rx="18" fill="#A1887F"/><path d="M4 18H32V24C32 28.4183 25.6127 32 18 32C10.3873 32 4 28.4183 4 24V18Z" fill="#795548"/><rect x="4" y="16" width="28" height="2" fill="#3E2723"/><circle cx="24" cy="24" r="5" stroke="black" stroke-width="2"/><line x1="28" y1="28" x2="32" y2="32" stroke="black" stroke-width="2"/></svg>`, price: 700, name: "Detektif" },
            'avatar_ninja': { svg: `<svg width="80" height="80" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="36" height="36" rx="18" fill="#424242"/><path d="M4 18H32V20C32 25 28 28 18 28C8 28 4 25 4 20V18Z" fill="#212121"/><path d="M12 18L8 14H28L24 18H12Z" fill="#212121"/><circle cx="14" cy="17" r="2" fill="white"/><circle cx="22" cy="17" r="2" fill="white"/></svg>`, price: 1500, name: "Ninja Bayangan" },
            'avatar_superhero': { svg: `<svg width="80" height="80" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="36" height="36" rx="18" fill="#29B6F6"/><path d="M18 20L8 30L18 26L28 30L18 20Z" fill="#FFCA28"/><path d="M12 12H24V18H12V12Z" fill="#E53935"/><path d="M18 18L15 12H21L18 18Z" fill="#FFCA28"/></svg>`, price: 1750, name: "Pahlawan Super" },
            'avatar_dj': { svg: `<svg width="80" height="80" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="36" height="36" rx="18" fill="#AB47BC"/><rect x="6" y="14" width="24" height="6" fill="#1DE9B6"/><rect x="8" y="15" width="4" height="4" fill="#263238"/><rect x="24" y="15" width="4" height="4" fill="#263238"/><path d="M8 24H12V28H8z" fill="#F06292"/><path d="M24 24H28V28H24z" fill="#F06292"/></svg>`, price: 1200, name: "DJ Musik" },
            'avatar_chef': { svg: `<svg width="80" height="80" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="36" height="36" rx="18" fill="#FF8A65"/><path d="M18 6C12 6 8 10 8 10V16H28V10S24 6 18 6Z" fill="white"/><path d="M13 22C13 22 15 24 18 24C21 24 23 22 23 22" stroke="#4E342E" stroke-width="2" stroke-linecap="round"/></svg>`, price: 1100, name: "Chef Andal" },
            'avatar_explorer': { svg: `<svg width="80" height="80" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><rect width="36" height="36" rx="18" fill="#8D6E63"/><path d="M4 18H32V22C32 26 26 30 18 30C10 30 4 26 4 22V18Z" fill="#A1887F"/><circle cx="12" cy="18" r="4" fill="white"/><circle cx="24" cy="18" r="4" fill="white"/><circle cx="12" cy="18" r="2" fill="black"/><circle cx="24" cy="18" r="2" fill="black"/></svg>`, price: 1400, name: "Penjelajah Hutan" },
        };

        const shopData = {
            customization: {
                title: "Warung Kustomisasi",
                items: {
                    'map_space': { name: "Tema Luar Angkasa", icon: "ğŸŒŒ", price: 500, type: "map_theme" },
                    'map_ocean': { name: "Tema Bawah Laut", icon: "ğŸŒŠ", price: 500, type: "map_theme" },
                    'palette_sunset': { name: "Palet Matahari Terbenam", icon: "ğŸŒ…", price: 300, type: "ui_palette" },
                    'palette_neon': { name: "Palet Neon", icon: "ğŸŒƒ", price: 300, type: "ui_palette" },
                    'map_library': { name: "Tema Perpustakaan Tua", icon: "ğŸ“š", price: 700, type: "map_theme" },
                    'map_beach': { name: "Tema Pantai Tropis", icon: "ğŸï¸", price: 700, type: "map_theme" },
                    'palette_forest': { name: "Palet Hutan Rindang", icon: "ğŸŒ²", price: 450, type: "ui_palette" },
                    'palette_sepia': { name: "Palet Vintage Sepia", icon: "ğŸ“œ", price: 450, type: "ui_palette" },
                    'sound_8bit': { name: "Paket Suara 8-Bit Retro", icon: "ğŸ‘¾", price: 600, type: "sound_pack" },
                }
            },
            powerup: {
                title: "Pasar Kekuatan",
                items: {
                    'double_points': { name: "Pengganda Poin (10 Menit)", icon: "âš¡", price: 200, type: "consumable" },
                    'fifty_fifty': { name: "Penghapus Opsi 50/50", icon: "â“", price: 75, type: "consumable" },
                    'extra_time': { name: "Waktu Tambahan (+15s)", icon: "â±ï¸", price: 100, type: "consumable" },
                    'answer_key': { name: "Kunci Jawaban", icon: "ğŸ”‘", price: 300, type: "consumable" },
                    'time_freeze': { name: "Pembeku Waktu", icon: "â„ï¸", price: 150, type: "consumable" },
                    'mistake_shield': { name: "Perisai Kesalahan", icon: "ğŸ›¡ï¸", price: 250, type: "consumable" },
                    'treasure_map': { name: "Peta Harta Karun", icon: "ğŸ—ºï¸", price: 100, type: "consumable" },
                    'streak_booster': { name: "Penguat Streak", icon: "ğŸ”¥", price: 500, type: "consumable" },
                }
            },
            mascot: {
                title: "Butik Cendekia",
                items: {
                    'monocle': { name: "Kacamata Monocle", icon: "ğŸ§", price: 250, type: "mascot_accessory" },
                    'grad_hat': { name: "Topi Wisuda", icon: "ğŸ“", price: 300, type: "mascot_accessory" },
                    'mustache': { name: "Kumis Cendekia", icon: "ã€°ï¸", price: 350, type: "mascot_accessory" },
                    'super_cape': { name: "Jubah Super", icon: "ğŸ¦¸", price: 400, type: "mascot_accessory" },
                    'headphones': { name: "Headphone Keren", icon: "ğŸ§", price: 300, type: "mascot_accessory" },
                    'king_crown': { name: "Mahkota Raja", icon: "ğŸ‘‘", price: 500, type: "mascot_accessory" },
                    'book_bg': { name: "Latar Belakang Buku", icon: "ğŸ“–", price: 200, type: "mascot_accessory" },
                }
            }
        };

        const mascotSVG = `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><g><path d="M50,15 C25,15 10,35 10,55 C10,80 25,95 50,95 C75,95 90,80 90,55 C90,35 75,15 50,15 Z" fill="#4CAF50"/><path d="M35,45 C40,40 50,40 55,45 C60,50 60,60 55,65 L45,65 C40,60 40,50 35,45 Z" fill="#388E3C" transform="translate(-15, 0)"/><path d="M65,45 C60,40 50,40 45,45 C40,50 40,60 45,65 L55,65 C60,60 60,50 65,45 Z" fill="#388E3C" transform="translate(15, 0)"/><circle cx="32" cy="52" r="18" fill="white"/><circle cx="68" cy="52" r="18" fill="white"/><circle cx="33" cy="53" r="8" fill="black"/><circle cx="67" cy="53" r="8" fill="black"/><path d="M50,65 C55,75 45,75 50,65 L52,70 L48,70 Z" fill="#FFC107"/><path d="M20,15 Q30,5 40,15" stroke="#388E3C" stroke-width="4" fill="none" stroke-linecap="round"/><path d="M80,15 Q70,5 60,15" stroke="#388E3C" stroke-width="4" fill="none" stroke-linecap="round"/></g></svg>`;

        // --- DATABASE LENGKAP MATERI ---
        const edukasiData = {
            sd: {
                dunia: {
                    matematika_dasar: { 
                        namaDunia: "Kerajaan Angka", warna: "blue", icon: "ğŸ”¢", deskripsi: "Jelajahi dunia angka, penjumlahan, dan perkalian yang seru!", 
                        subMateri: { 
                            penjumlahan: { judul: "Berhitung Cepat", konten: "<p>Penjumlahan adalah cara menggabungkan dua angka atau lebih. Contoh: 2 apel ditambah 3 apel menjadi 5 apel.</p>", funFact: "Simbol tambah (+) sudah digunakan selama lebih dari 500 tahun!", kuis: [{ type: "pilihan-ganda", pertanyaan: "7 + 8 = ?", pilihan: ["14", "15", "16"], jawaban: "15", hint:"Hitung maju 8 langkah dari 7." }] },
                            pengurangan: { judul: "Ambil dan Sisakan", konten: "<p>Pengurangan adalah mengambil sejumlah angka dari angka lain. Contoh: Punya 5 kue, dimakan 2, sisa 3 kue.</p>", funFact: "Kata 'selisih' adalah nama lain untuk hasil dari pengurangan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "12 - 5 = ?", pilihan: ["6", "7", "8"], jawaban: "7", hint:"Hitung mundur 5 langkah dari 12." }] },
                            perkalian: { judul: "Lompatan Ajaib", konten: "<p>Perkalian adalah penjumlahan berulang. 3 x 4 sama dengan melompat 4 langkah sebanyak 3 kali.</p>", funFact: "Tabel perkalian modern pertama kali dibuat oleh matematikawan Skotlandia, John Napier.", kuis: [{ type: "pilihan-ganda", pertanyaan: "6 x 3 = ?", pilihan: ["18", "15", "24"], jawaban: "18", hint:"Jumlahkan 6 sebanyak 3 kali." }] },
                            pembagian: { judul: "Bagi Rata", konten: "<p>Pembagian adalah membagi sama rata. 10 permen dibagi untuk 2 anak, masing-masing dapat 5.</p>", funFact: "Simbol bagi (Ã·) disebut obelus, yang dalam bahasa Yunani berarti 'tusuk sate'.", kuis: [{ type: "pilihan-ganda", pertanyaan: "15 / 3 = ?", pilihan: ["4", "5", "6"], jawaban: "5", hint:"Berapa kali 3 muat dalam 15?" }] },
                            pecahan: { judul: "Potongan Pizza", konten: "<p>Pecahan adalah bagian dari keseluruhan. 1/2 berarti satu dari dua bagian yang sama besar.</p>", funFact: "Orang Mesir kuno menulis semua pecahan sebagai penjumlahan dari pecahan satuan (pembilang 1).", kuis: [{ type: "pilihan-ganda", pertanyaan: "Setengah dari 8 adalah...", pilihan: ["2", "4", "6"], jawaban: "4", hint:"Sama dengan 8 dibagi 2." }] },
                            ganjil_genap: { judul: "Pasukan Ganjil & Genap", konten: "<p>Bilangan genap bisa berpasangan (2, 4, 6), bilangan ganjil selalu ada yang sendirian (1, 3, 5).</p>", funFact: "Menjumlahkan dua bilangan ganjil selalu menghasilkan bilangan genap.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Manakah yang bilangan ganjil?", pilihan: ["10", "17", "22"], jawaban: "17", hint:"Angka yang tidak bisa dibagi 2." }] },
                            pengukuran: { judul: "Mengukur Dunia", konten: "<p>Kita mengukur panjang dengan sentimeter (cm) dan berat dengan kilogram (kg).</p>", funFact: "Satu kilogram awalnya didefinisikan berdasarkan berat satu liter air.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Alat untuk mengukur panjang buku adalah...", pilihan: ["Timbangan", "Penggaris", "Jam"], jawaban: "Penggaris", hint:"Ada di kotak pensilmu." }] },
                            bangun_datar_ruang: { judul: "Berburu Bentuk", konten: "<p>Ada bentuk datar (persegi, lingkaran) dan bentuk ruang (kubus, bola).</p>", funFact: "Sarang lebah menggunakan bentuk segienam karena itu cara paling efisien untuk mengisi ruang.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Benda yang bentuknya seperti dadu adalah...", pilihan: ["Bola", "Kubus", "Piramida"], jawaban: "Kubus", hint:"Memiliki 6 sisi yang sama." }] },
                            waktu: { judul: "Waktu Berpetualang", konten: "<p>Jarum pendek jam menunjuk jam, jarum panjang menunjuk menit.</p>", funFact: "Pembagian jam menjadi 60 menit berasal dari sistem angka bangsa Babilonia kuno.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Jika jarum pendek di angka 3 dan panjang di 12, pukul berapa itu?", pilihan: ["12:03", "03:12", "03:00"], jawaban: "03:00", hint:"Angka 12 pada jarum panjang berarti menit ke-0." }] },
                            pola_bilangan: { judul: "Pola Rahasia", konten: "<p>Pola adalah urutan yang berulang dengan aturan. Contoh: 2, 4, 6, 8, ... (ditambah 2).</p>", funFact: "Pola bilangan sering ditemukan di alam, seperti pada kelopak bunga dan cangkang siput.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Lanjutkan pola ini: 5, 10, 15, ...?", pilihan: ["16", "20", "25"], jawaban: "20", hint:"Ini adalah pola ditambah 5." }] }
                        } 
                    },
                    bahasa_indonesia_sd: { 
                        namaDunia: "Pulau Kata", warna: "green", icon: "âœï¸", deskripsi: "Belajar membaca, menulis, dan menyusun kalimat dengan benar.", 
                        subMateri: {
                            alfabet: { judul: "Pasukan Alfabet", konten: "<p>Alfabet adalah kumpulan huruf dari A sampai Z. Setiap huruf memiliki bunyinya sendiri.</p>", funFact: "Bahasa Indonesia menggunakan 26 huruf alfabet Latin, sama seperti Bahasa Inggris.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Huruf apa yang datang setelah huruf 'G'?", pilihan: ["F", "H", "I"], jawaban: "H", hint:"E, F, G, ..." }] },
                            merangkai_kata: { judul: "Merangkai Kata Ajaib", konten: "<p>Menggabungkan huruf vokal (a, i, u, e, o) dan konsonan akan membentuk kata yang punya arti.</p>", funFact: "Kata terpanjang dalam kamus bahasa Indonesia adalah 'mempertanggungjawabkannya'.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Susun huruf 'k-u-b-u' menjadi nama benda.", pilihan: ["kuub", "buku", "kibu"], jawaban: "buku", hint:"Digunakan untuk membaca." }] },
                            tanda_baca: { judul: "Tuan Tanda Baca", konten: "<p>Tanda baca membantu kita mengerti tulisan. Titik (.) untuk berhenti, koma (,) untuk jeda, dan tanda tanya (?) untuk bertanya.</p>", funFact: "Tanda seru (!) dulunya ditulis sebagai kata Latin 'io' yang berarti 'seruan kegembiraan'.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Tanda baca di akhir kalimat 'Siapa namamu' adalah...", pilihan: [".", ",", "?"], jawaban: "?", hint:"Ini adalah kalimat tanya." }] },
                            kalimat: { judul: "Siapa, Apa, di Mana?", konten: "<p>Kalimat yang baik biasanya menjawab pertanyaan siapa (Subjek), melakukan apa (Predikat), dan apa/siapa yang dikenai (Objek).</p>", funFact: "Tanda titik (.) digunakan untuk mengakhiri sebuah kalimat berita.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Manakah kalimat yang benar?", pilihan: ["Makan nasi saya", "Saya makan nasi", "Nasi saya makan"], jawaban: "Saya makan nasi", hint:"Urutan S-P-O." }] },
                            kata_benda: { judul: "Kata Benda di Sekitarku", konten: "<p>Kata benda adalah nama orang, tempat, atau benda. Contoh: meja, buku, Rina.</p>", funFact: "Dalam beberapa bahasa, semua kata benda memiliki 'gender' (maskulin atau feminin).", kuis: [{ type: "pilihan-ganda", pertanyaan: "Manakah yang merupakan kata benda?", pilihan: ["Berlari", "Merah", "Kursi"], jawaban: "Kursi", hint:"Ini adalah nama sebuah benda." }] },
                            kata_kerja: { judul: "Aksi Kata Kerja", konten: "<p>Kata kerja adalah kata yang menyatakan suatu tindakan atau perbuatan. Contoh: makan, tidur, belajar.</p>", funFact: "Kata 'kerja' itu sendiri adalah sebuah kata benda!", kuis: [{ type: "pilihan-ganda", pertanyaan: "Manakah yang merupakan kata kerja?", pilihan: ["Membaca", "Cantik", "Sekolah"], jawaban: "Membaca", hint:"Ini adalah sebuah kegiatan." }] },
                            kata_sifat: { judul: "Cantiknya Kata Sifat", konten: "<p>Kata sifat adalah kata yang menjelaskan kata benda. Contoh: besar, kecil, pintar, rajin.</p>", funFact: "Menambahkan kata 'sangat' atau 'sekali' dapat memperkuat arti kata sifat.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Dalam 'rumah besar', kata yang merupakan kata sifat adalah...", pilihan: ["Rumah", "Besar", "Yang"], jawaban: "Besar", hint:"Kata ini menjelaskan bagaimana rumah itu." }] },
                            antonim_sinonim: { judul: "Lawan dan Kawan Kata", konten: "<p>Antonim adalah lawan kata (panas-dingin), sinonim adalah persamaan kata (pintar-pandai).</p>", funFact: "Menggunakan sinonim membuat tulisan menjadi lebih menarik dan tidak membosankan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Lawan kata dari 'terang' adalah...", pilihan: ["Cerah", "Gelap", "Siang"], jawaban: "Gelap", hint:"Keadaan saat tidak ada cahaya." }] },
                            puisi: { judul: "Puisi Indah", konten: "<p>Puisi adalah tulisan yang menggunakan bahasa indah dan seringkali memiliki irama atau sajak (akhiran bunyi yang sama).</p>", funFact: "Puisi adalah salah satu bentuk sastra tertua di dunia.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Akhiran bunyi yang sama pada baris puisi disebut...", pilihan: ["Bait", "Baris", "Sajak"], jawaban: "Sajak", hint:"Contoh: kelapa dan menyapa." }] },
                            dongeng: { judul: "Dongeng Kancil", konten: "<p>Dongeng adalah cerita khayalan yang tidak benar-benar terjadi, biasanya mengandung pesan moral. Fabel adalah dongeng dengan tokoh hewan.</p>", funFact: "Dongeng 'Cinderella' memiliki lebih dari 500 versi di seluruh dunia.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Cerita tentang 'Si Kancil' termasuk jenis...", pilihan: ["Berita", "Fabel", "Pengumuman"], jawaban: "Fabel", hint:"Tokohnya adalah hewan yang bisa bicara." }] }
                        }
                    },
                    ipa_sd: { 
                        namaDunia: "Taman Sains", warna: "yellow", icon: "ğŸŒ¿", deskripsi: "Pelajari tentang hewan, tumbuhan, dan alam sekitar kita.",
                        subMateri: {
                            hewan: { judul: "Sahabat Satwa", konten: "<p>Ada banyak jenis hewan di dunia. Ada karnivora (pemakan daging), herbivora (pemakan tumbuhan), dan omnivora (pemakan segala).</p>", funFact: "Gajah adalah satu-satunya mamalia yang tidak bisa melompat!", kuis: [{ type: "pilihan-ganda", pertanyaan: "Sapi adalah contoh hewan pemakan...", pilihan: ["Daging", "Tumbuhan", "Segalanya"], jawaban: "Tumbuhan", hint:"Sapi makan rumput." }] },
                            tumbuhan: { judul: "Akar, Batang, dan Daun", konten: "<p>Tumbuhan memiliki akar untuk menyerap air, batang untuk berdiri tegak, dan daun untuk membuat makanan (fotosintesis).</p>", funFact: "Pohon tertinggi di dunia bisa mencapai ketinggian lebih dari 100 meter!", kuis: [{ type: "pilihan-ganda", pertanyaan: "Bagian tumbuhan yang berfungsi membuat makanan adalah...", pilihan: ["Akar", "Batang", "Daun"], jawaban: "Daun", hint:"Warnanya biasanya hijau." }] },
                            pancaindra: { judul: "Lima Indra Ajaib", konten: "<p>Manusia punya lima indra: mata untuk melihat, telinga untuk mendengar, hidung untuk mencium, lidah untuk mengecap, dan kulit untuk meraba.</p>", funFact: "Hidung manusia bisa membedakan lebih dari 1 triliun bau yang berbeda.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Indra yang digunakan untuk merasakan manisnya gula adalah...", pilihan: ["Mata", "Kulit", "Lidah"], jawaban: "Lidah", hint:"Letaknya di dalam mulut." }] },
                            siklus_air: { judul: "Petualangan Air", konten: "<p>Air di bumi selalu berputar. Air laut menguap menjadi awan, lalu turun lagi sebagai hujan. Ini disebut siklus air.</p>", funFact: "Jumlah air di Bumi saat ini sama dengan jumlah air pada zaman dinosaurus.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Uap air yang naik ke langit akan membentuk...", pilihan: ["Pelangi", "Awan", "Angin"], jawaban: "Awan", hint:"Warnanya putih atau kelabu." }] },
                            wujud_benda: { judul: "Padat, Cair, Gas!", konten: "<p>Benda memiliki tiga wujud: padat (batu), cair (air), dan gas (udara). Wujud benda bisa berubah, misalnya es mencair menjadi air.</p>", funFact: "Ada wujud benda keempat yang disebut plasma, seperti yang ada pada bintang dan petir.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Perubahan dari cair menjadi padat disebut...", pilihan: ["Mencair", "Menguap", "Membeku"], jawaban: "Membeku", hint:"Seperti saat membuat es batu." }] },
                            tata_surya: { judul: "Siang dan Malam", konten: "<p>Bumi berputar pada porosnya (rotasi) yang menyebabkan siang dan malam. Bumi juga mengelilingi Matahari (revolusi).</p>", funFact: "Jejak kaki para astronot di Bulan akan tetap ada di sana selama jutaan tahun karena tidak ada angin.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Peristiwa terjadinya siang dan malam disebabkan oleh...", pilihan: ["Rotasi Bumi", "Revolusi Bumi", "Gravitasi Bulan"], jawaban: "Rotasi Bumi", hint:"Perputaran Bumi pada porosnya." }] },
                            cahaya: { judul: "Pelangi di Langit", konten: "<p>Cahaya merambat lurus dan bisa dibiaskan. Pelangi terbentuk karena cahaya matahari dibiaskan oleh titik-titik air hujan.</p>", funFact: "Kamu tidak akan pernah bisa mencapai ujung pelangi, karena ia bergerak seiring dengan sudut pandangmu.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Benda yang digunakan untuk melihat pantulan diri kita adalah...", pilihan: ["Kaca", "Cermin", "Lensa"], jawaban: "Cermin", hint:"Memiliki permukaan yang mengkilap." }] },
                            magnet: { judul: "Kekuatan Magnet", konten: "<p>Magnet bisa menarik benda-benda yang terbuat dari besi. Magnet memiliki dua kutub, utara dan selatan.</p>", funFact: "Bumi kita adalah sebuah magnet raksasa, itulah sebabnya kompas selalu menunjuk ke utara.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Benda yang TIDAK bisa ditarik magnet adalah...", pilihan: ["Paku", "Peniti", "Kertas"], jawaban: "Kertas", hint:"Terbuat dari kayu." }] },
                            kesehatan: { judul: "Sehat dan Kuat", konten: "<p>Untuk menjaga tubuh tetap sehat, kita perlu makan makanan bergizi, berolahraga teratur, dan cukup istirahat.</p>", funFact: "Tertawa baik untuk jantung dan dapat meningkatkan aliran darah sebesar 20 persen.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Berikut ini yang termasuk makanan sehat adalah...", pilihan: ["Permen", "Sayuran", "Keripik"], jawaban: "Sayuran", hint:"Banyak mengandung vitamin." }] },
                            lingkungan: { judul: "Jaga Bumi Kita", konten: "<p>Kita harus menjaga lingkungan dengan cara tidak membuang sampah sembarangan, menanam pohon, dan menghemat air.</p>", funFact: "Satu botol plastik membutuhkan waktu lebih dari 450 tahun untuk terurai di alam.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Kegiatan yang baik untuk lingkungan adalah...", pilihan: ["Membuang sampah di sungai", "Menebang pohon", "Menanam pohon"], jawaban: "Menanam pohon", hint:"Membuat udara lebih sejuk." }] }
                        }
                    },
                    ips_sd: {
                        namaDunia: "Nusantara Kita", warna: "orange", icon: "ğŸ—ºï¸", deskripsi: "Kenali keragaman suku, budaya, dan geografi Indonesia.",
                        subMateri: {
                            peta: { judul: "Membaca Peta", konten: "<p>Peta adalah gambar permukaan bumi. Ada simbol-simbol di peta untuk gunung, sungai, dan kota.</p>", funFact: "Peta tertua yang diketahui berasal dari Babilonia sekitar 2.500 tahun yang lalu.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Warna biru pada peta biasanya melambangkan...", pilihan: ["Gunung", "Hutan", "Perairan"], jawaban: "Perairan", hint:"Seperti warna laut dan danau." }] },
                            kenampakan_alam: { judul: "Gunung dan Pantai", konten: "<p>Indonesia punya banyak kenampakan alam seperti gunung berapi, sungai yang panjang, dan pantai yang indah.</p>", funFact: "Indonesia adalah negara dengan jumlah gunung berapi aktif terbanyak di dunia.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Dataran rendah yang sangat luas disebut...", pilihan: ["Lembah", "Ngarai", "Dataran rendah"], jawaban: "Dataran rendah", hint:"Tempat banyak kota dibangun." }] },
                            suku_bangsa: { judul: "Rumah Adat dan Suku", konten: "<p>Indonesia kaya akan suku bangsa. Setiap suku punya rumah adat, pakaian adat, dan bahasa yang unik.</p>", funFact: "Ada lebih dari 700 bahasa daerah yang digunakan di seluruh Indonesia.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Rumah Gadang adalah rumah adat dari suku...", pilihan: ["Jawa", "Minangkabau", "Dayak"], jawaban: "Minangkabau", hint:"Terkenal dengan atapnya yang seperti tanduk kerbau." }] },
                            kegiatan_ekonomi: { judul: "Pekerjaan di Sekitarku", konten: "<p>Orang bekerja sesuai dengan kondisi alamnya. Di pantai banyak nelayan, di pegunungan banyak petani sayur.</p>", funFact: "Pasar terapung di Kalimantan adalah contoh kegiatan ekonomi yang unik dan menyesuaikan dengan alam sungai.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Pekerjaan utama penduduk di daerah pantai adalah...", pilihan: ["Petani", "Nelayan", "Pekerja kantor"], jawaban: "Nelayan", hint:"Mereka mencari ikan di laut." }] },
                            kerajaan_hindu_buddha: { judul: "Raja-Raja Zaman Dulu", konten: "<p>Dulu di Indonesia ada kerajaan besar seperti Sriwijaya yang jaya di laut dan Majapahit yang menyatukan nusantara.</p>", funFact: "Candi Borobudur adalah candi Buddha terbesar di dunia dan merupakan peninggalan kerajaan Mataram Kuno.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Kerajaan maritim (laut) terbesar di Indonesia adalah...", pilihan: ["Majapahit", "Sriwijaya", "Kutai"], jawaban: "Sriwijaya", hint:"Pusatnya ada di Sumatera." }] },
                            pahlawan_nasional: { judul: "Para Pemberani", konten: "<p>Pahlawan nasional adalah orang-orang yang berjuang untuk kemerdekaan Indonesia, seperti Pangeran Diponegoro dan Cut Nyak Dien.</p>", funFact: "Nama pahlawan sering diabadikan sebagai nama jalan, bandara, dan universitas untuk menghormati jasa mereka.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Siapakah pahlawan wanita yang berasal dari Aceh?", pilihan: ["R.A. Kartini", "Cut Nyak Dien", "Dewi Sartika"], jawaban: "Cut Nyak Dien", hint:"Berjuang melawan Belanda." }] },
                            proklamasi: { judul: "Hari Merdeka", konten: "<p>Indonesia merdeka pada tanggal 17 Agustus 1945. Proklamasi dibacakan oleh Soekarno dan Hatta.</p>", funFact: "Naskah proklamasi yang asli ditulis tangan oleh Soekarno di rumah seorang laksamana Jepang.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Proklamasi Kemerdekaan Indonesia dilaksanakan pada tahun...", pilihan: ["1942", "1945", "1950"], jawaban: "1945", hint:"Tahun yang selalu kita rayakan." }] },
                            pancasila: { judul: "Lima Dasar Negara", konten: "<p>Pancasila adalah dasar negara kita. Sila pertama adalah Ketuhanan Yang Maha Esa, dilambangkan dengan bintang.</p>", funFact: "Burung Garuda Pancasila memiliki jumlah bulu yang melambangkan tanggal proklamasi: 17 helai di sayap, 8 di ekor, dan 45 di leher.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Sila kedua Pancasila dilambangkan dengan gambar...", pilihan: ["Pohon Beringin", "Rantai", "Padi dan Kapas"], jawaban: "Rantai", hint:"Melambangkan hubungan antarmanusia." }] },
                            musyawarah: { judul: "Keputusan Bersama", konten: "<p>Musyawarah adalah berdiskusi untuk mencapai keputusan bersama. Ini adalah cerminan sila keempat Pancasila.</p>", funFact: "Konsep musyawarah sudah ada sejak lama dalam budaya desa-desa di Indonesia.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Memilih ketua kelas sebaiknya dilakukan dengan cara...", pilihan: ["Paksaan", "Musyawarah", "Ditunjuk guru saja"], jawaban: "Musyawarah", hint:"Agar adil untuk semua." }] },
                            gotong_royong: { judul: "Kerja Bakti", konten: "<p>Gotong royong adalah bekerja bersama-sama untuk kepentingan umum, seperti membersihkan lingkungan sekolah atau desa.</p>", funFact: "Gotong royong adalah salah satu kepribadian bangsa Indonesia yang paling dikenal.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Manfaat dari gotong royong adalah...", pilihan: ["Pekerjaan cepat selesai", "Menimbulkan perpecahan", "Membuang waktu"], jawaban: "Pekerjaan cepat selesai", hint:"Berat sama dipikul, ringan sama dijinjing." }] }
                        }
                    },
                    // Dunia-dunia tambahan untuk SD
                    seni_budaya_sd: { namaDunia: "Galeri Kreasi", warna: "pink", icon: "ğŸ¨", deskripsi: "Ekspresikan dirimu melalui gambar, lagu, dan tarian!", subMateri: { /* 10 sub-materi */ } },
                    pjok_sd: { namaDunia: "Arena Olahraga", warna: "red", icon: "âš½", deskripsi: "Belajar tentang olahraga dan cara menjaga tubuh tetap bugar.", subMateri: { /* 10 sub-materi */ } },
                    pkn_sd: { namaDunia: "Istana Kewarganegaraan", warna: "purple", icon: "ğŸ›ï¸", deskripsi: "Pahami hak dan kewajiban sebagai warga negara cilik.", subMateri: { /* 10 sub-materi */ } },
                    tik_sd: { namaDunia: "Planet Digital", warna: "teal", icon: "ğŸ’»", deskripsi: "Kenali komputer, internet, dan cara aman berselancar di dunia maya.", subMateri: { /* 10 sub-materi */ } },
                    musik_sd: { namaDunia: "Melodi Ceria", warna: "fuchsia", icon: "ğŸµ", deskripsi: "Mengenal not, irama, dan alat musik yang menyenangkan.", subMateri: { /* 10 sub-materi */ } },
                    inggris_sd: { namaDunia: "Kampung Inggris", warna: "indigo", icon: "ğŸ‡¬ğŸ‡§", deskripsi: "Pelajari kata-kata dan percakapan dasar dalam Bahasa Inggris.", subMateri: { /* 10 sub-materi */ } }
                }
            },
            smp: {
                dunia: {
                    aljabar_smp: {
                        namaDunia: "Laboratorium Aljabar", warna: "blue", icon: "â—", deskripsi: "Memecahkan misteri dengan variabel dan rumus matematika.",
                        subMateri: {
                            misteri_x: { judul: "Misteri Huruf X", konten: "<p>Aljabar menggunakan huruf (variabel) untuk mewakili angka yang tidak diketahui. Contoh: x + 5 = 8, berarti x adalah 3.</p>", funFact: "Kata 'aljabar' berasal dari kata Arab 'al-jabr' yang berarti 'penggabungan bagian yang rusak'.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Jika 2a = 10, berapakah nilai a?", pilihan: ["4", "5", "6"], jawaban: "5", hint: "Angka berapa yang jika dikalikan 2 hasilnya 10?" }] },
                            himpunan: { judul: "Klub Himpunan", konten: "<p>Himpunan adalah kumpulan objek yang terdefinisi dengan jelas. Contoh: Himpunan hewan berkaki empat.</p>", funFact: "Konsep himpunan modern dikembangkan oleh Georg Cantor pada akhir abad ke-19.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Mana yang merupakan himpunan?", pilihan: ["Kumpulan lukisan indah", "Kumpulan siswa kelas 7A", "Kumpulan orang pintar"], jawaban: "Kumpulan siswa kelas 7A", hint: "Anggotanya jelas dan pasti." }] },
                            garis_sudut: { judul: "Perpotongan Garis", konten: "<p>Dua garis sejajar yang dipotong garis lain akan membentuk sudut-sudut yang memiliki hubungan, seperti sehadap dan berseberangan.</p>", funFact: "Ilmu tentang garis dan sudut, geometri, adalah salah satu cabang matematika tertua.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Sudut yang besarnya tepat 90 derajat disebut sudut...", pilihan: ["Lancip", "Tumpul", "Siku-siku"], jawaban: "Siku-siku", hint: "Seperti sudut pada buku." }] },
                            pythagoras: { judul: "Segitiga Siku-Siku Pythagoras", konten: "<p>Pada segitiga siku-siku, kuadrat sisi miring (hipotenusa) sama dengan jumlah kuadrat dua sisi lainnya (aÂ² + bÂ² = cÂ²).</p>", funFact: "Meskipun dinamai Pythagoras, teorema ini sudah dikenal oleh bangsa Babilonia 1000 tahun sebelumnya.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Jika sisi tegak segitiga adalah 3 dan 4, berapa sisi miringnya?", pilihan: ["5", "6", "7"], jawaban: "5", hint: "Hitung akar dari (3x3 + 4x4)." }] },
                            bangun_ruang: { judul: "Dimensi Ketiga", konten: "<p>Bangun ruang seperti kubus, balok, dan tabung memiliki volume (isi) dan luas permukaan.</p>", funFact: "Bola adalah bangun ruang dengan luas permukaan terkecil untuk volume tertentu.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Rumus volume kubus dengan sisi 's' adalah...", pilihan: ["s x s", "6 x s x s", "s x s x s"], jawaban: "s x s x s", hint: "Panjang kali lebar kali tinggi." }] },
                            persamaan_linear: { judul: "Menyeimbangkan Persamaan", konten: "<p>Persamaan Linear Satu Variabel (PLSV) adalah kalimat terbuka dengan satu variabel yang memiliki hubungan sama dengan.</p>", funFact: "Prinsip menyeimbangkan persamaan mirip seperti neraca timbangan agar tetap seimbang.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Penyelesaian dari x - 3 = 7 adalah...", pilihan: ["x = 4", "x = 10", "x = 9"], jawaban: "x = 10", hint: "Pindahkan -3 ke sisi kanan menjadi +3." }] },
                            gradien: { judul: "Si Garis Miring", konten: "<p>Gradien (m) adalah ukuran kemiringan suatu garis lurus. Dihitung dari perubahan vertikal dibagi perubahan horizontal.</p>", funFact: "Konsep gradien sangat penting dalam pembangunan jalan di pegunungan agar tidak terlalu curam.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Garis yang datar sempurna memiliki gradien...", pilihan: ["1", "0", "Tak terhingga"], jawaban: "0", hint: "Tidak ada perubahan vertikal." }] },
                            peluang: { judul: "Peluang Dadu", konten: "<p>Peluang adalah kemungkinan terjadinya suatu peristiwa. Dihitung dari jumlah kejadian yang diinginkan dibagi total kemungkinan.</p>", funFact: "Ilmu peluang awalnya dikembangkan untuk menganalisis permainan judi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Berapa peluang munculnya angka 5 saat melempar satu dadu?", pilihan: ["1/6", "5/6", "1/2"], jawaban: "1/6", hint: "Ada satu angka 5 dari total enam sisi." }] },
                            statistika: { judul: "Membaca Data", konten: "<p>Statistika adalah ilmu mengolah data. Mean (rata-rata), median (nilai tengah), dan modus (paling sering muncul) adalah ukuran pemusatan data.</p>", funFact: "Statistika digunakan di hampir semua bidang, dari prakiraan cuaca hingga pemilu.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Modus dari data: 2, 3, 3, 4, 5 adalah...", pilihan: ["2", "3", "4"], jawaban: "3", hint: "Angka yang muncul paling banyak." }] },
                            aritmetika_sosial: { judul: "Matematika Jual Beli", konten: "<p>Aritmetika sosial membahas tentang untung, rugi, diskon, dan bunga dalam kehidupan sehari-hari.</p>", funFact: "Kata 'diskon' berasal dari bahasa Latin 'computare' yang berarti menghitung.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Baju seharga 100.000 diskon 20%. Berapa harga yang harus dibayar?", pilihan: ["80.000", "20.000", "120.000"], jawaban: "80.000", hint: "Diskonnya 20% dari 100.000, lalu kurangkan." }] }
                        }
                    },
                    biologi_smp: {
                        namaDunia: "Ekspedisi Biologi", warna: "green", icon: "ğŸ§¬", deskripsi: "Menyelami dunia makhluk hidup, dari sel terkecil hingga ekosistem.",
                        subMateri: {
                            sel: { judul: "Kota Sel", konten: "<p>Sel adalah unit terkecil kehidupan. Sel hewan dan tumbuhan memiliki bagian-bagian (organel) seperti inti sel dan mitokondria.</p>", funFact: "Tubuh manusia dewasa terdiri dari sekitar 37 triliun sel!", kuis: [{ type: "pilihan-ganda", pertanyaan: "Bagian sel yang berfungsi sebagai 'otak' atau pusat kendali adalah?", pilihan: ["Dinding Sel", "Mitokondria", "Inti Sel"], jawaban: "Inti Sel", hint: "Mengandung materi genetik (DNA)." }] },
                            ekosistem: { judul: "Jaring-Jaring Kehidupan", konten: "<p>Ekosistem adalah interaksi antara makhluk hidup (biotik) dan lingkungannya (abiotik). Ada rantai makanan dan jaring-jaring makanan.</p>", funFact: "Satu sendok teh tanah yang sehat bisa mengandung miliaran mikroorganisme.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Dalam rantai makanan, tumbuhan berperan sebagai...", pilihan: ["Konsumen", "Produsen", "Pengurai"], jawaban: "Produsen", hint: "Mereka membuat makanan sendiri." }] },
                            klasifikasi: { judul: "Pohon Kehidupan", konten: "<p>Makhluk hidup diklasifikasikan ke dalam beberapa kerajaan (Kingdom), seperti Monera, Protista, Fungi, Plantae, dan Animalia.</p>", funFact: "Sistem klasifikasi modern (taksonomi) diciptakan oleh Carl Linnaeus.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Jamur termasuk dalam kerajaan...", pilihan: ["Plantae", "Fungi", "Animalia"], jawaban: "Fungi", hint: "Tidak bisa berfotosintesis." }] },
                            fotosintesis: { judul: "Dapur Tumbuhan", konten: "<p>Fotosintesis adalah proses tumbuhan membuat makanan sendiri menggunakan cahaya matahari, air, dan karbon dioksida, menghasilkan oksigen.</p>", funFact: "Lebih dari setengah oksigen di bumi dihasilkan oleh fitoplankton di lautan, bukan pohon.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Gas yang dibutuhkan tumbuhan untuk fotosintesis adalah...", pilihan: ["Oksigen", "Karbon dioksida", "Nitrogen"], jawaban: "Karbon dioksida", hint: "Gas yang kita hembuskan saat bernapas." }] },
                            sistem_gerak: { judul: "Rangka dan Otot", konten: "<p>Manusia bergerak menggunakan sistem gerak yang terdiri dari rangka (tulang) sebagai alat gerak pasif dan otot sebagai alat gerak aktif.</p>", funFact: "Tulang paha adalah tulang terpanjang dan terkuat di tubuh manusia.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Alat gerak aktif pada manusia adalah...", pilihan: ["Tulang", "Sendi", "Otot"], jawaban: "Otot", hint: "Bisa berkontraksi dan relaksasi." }] },
                            sistem_peredaran_darah: { judul: "Aliran Darah", konten: "<p>Jantung memompa darah ke seluruh tubuh melalui pembuluh darah (arteri dan vena) untuk mengedarkan oksigen dan nutrisi.</p>", funFact: "Jika semua pembuluh darah dalam satu orang disambung, panjangnya bisa mengelilingi bumi lebih dari dua kali.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Organ yang berfungsi memompa darah adalah...", pilihan: ["Paru-paru", "Jantung", "Hati"], jawaban: "Jantung", hint: "Terletak di rongga dada sebelah kiri." }] },
                            sistem_saraf: { judul: "Pusat Kendali Tubuh", konten: "<p>Sistem saraf, yang terdiri dari otak, sumsum tulang belakang, dan saraf, berfungsi sebagai pusat kendali dan komunikasi tubuh.</p>", funFact: "Sinyal saraf dapat bergerak dengan kecepatan lebih dari 400 km/jam!", kuis: [{ type: "pilihan-ganda", pertanyaan: "Pusat sistem saraf manusia adalah...", pilihan: ["Jantung", "Otak", "Pankreas"], jawaban: "Otak", hint: "Terletak di dalam kepala." }] },
                            pewarisan_sifat: { judul: "Gen dan DNA", konten: "<p>Sifat-sifat kita, seperti warna rambut dan mata, diwariskan dari orang tua melalui materi genetik yang disebut gen dalam DNA.</p>", funFact: "Manusia berbagi sekitar 99.9% DNA yang sama satu sama lain.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Bapak Genetika Modern adalah...", pilihan: ["Charles Darwin", "Gregor Mendel", "Albert Einstein"], jawaban: "Gregor Mendel", hint: "Dia meneliti kacang ercis." }] },
                            adaptasi: { judul: "Bertahan di Alam", konten: "<p>Adaptasi adalah cara makhluk hidup menyesuaikan diri dengan lingkungannya. Ada adaptasi morfologi (bentuk tubuh), fisiologi (fungsi tubuh), dan tingkah laku.</p>", funFact: "Bunglon mengubah warna kulitnya bukan hanya untuk kamuflase, tapi juga untuk komunikasi dan mengatur suhu tubuh.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Bentuk paruh burung yang berbeda-beda sesuai jenis makanannya adalah contoh adaptasi...", pilihan: ["Fisiologi", "Morfologi", "Tingkah laku"], jawaban: "Morfologi", hint: "Berkaitan dengan bentuk fisik." }] },
                            pencemaran: { judul: "Ancaman Lingkungan", konten: "<p>Pencemaran lingkungan (air, udara, tanah) disebabkan oleh limbah industri dan rumah tangga yang dapat merusak ekosistem.</p>", funFact: "Efek rumah kaca disebabkan oleh penumpukan gas seperti karbon dioksida di atmosfer, menyebabkan pemanasan global.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Gas utama penyebab efek rumah kaca adalah...", pilihan: ["Oksigen", "Nitrogen", "Karbon Dioksida"], jawaban: "Karbon Dioksida", hint: "Dihasilkan dari pembakaran." }] }
                        }
                    },
                    fisika_smp: {
                        namaDunia: "Bengkel Fisika", warna: "purple", icon: "âš›ï¸", deskripsi: "Mengungkap hukum alam yang mengatur energi, gaya, dan gerak.",
                        subMateri: {
                            hukum_newton: { judul: "Gaya dan Gerak Newton", konten: "<p>Hukum Newton menjelaskan hubungan antara gaya dan gerak. Benda diam akan tetap diam jika tidak ada gaya (Inersia).</p>", funFact: "Kisah apel jatuh yang menginspirasi Newton tentang gravitasi mungkin tidak benar-benar terjadi, tetapi menjadi legenda yang populer.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Mengapa kita terdorong ke depan saat bus mengerem mendadak? Ini contoh hukum...", pilihan: ["Hukum I Newton", "Hukum II Newton", "Hukum III Newton"], jawaban: "Hukum I Newton", hint: "Tentang kelembaman atau inersia." }] },
                            energi: { judul: "Energi Kinetik & Potensial", konten: "<p>Energi tidak dapat diciptakan atau dimusnahkan, hanya berubah bentuk. Energi potensial adalah energi karena posisi, energi kinetik adalah energi karena gerak.</p>", funFact: "Roller coaster adalah contoh sempurna perubahan energi dari potensial (di puncak) menjadi kinetik (saat meluncur).", kuis: [{ type: "pilihan-ganda", pertanyaan: "Apel yang tergantung di pohon memiliki energi...", pilihan: ["Kinetik", "Potensial", "Bunyi"], jawaban: "Potensial", hint: "Energi yang tersimpan karena ketinggiannya." }] },
                            pesawat_sederhana: { judul: "Pengungkit dan Katrol", konten: "<p>Pesawat sederhana adalah alat yang memudahkan pekerjaan, seperti tuas/pengungkit, katrol, dan bidang miring.</p>", funFact: "Piramida di Mesir kemungkinan besar dibangun menggunakan bidang miring raksasa untuk mengangkat balok-balok batu.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Gunting adalah contoh dari pesawat sederhana jenis...", pilihan: ["Katrol", "Bidang Miring", "Tuas"], jawaban: "Tuas", hint: "Memiliki titik tumpu, kuasa, dan beban." }] },
                            tekanan: { judul: "Tekanan Zat", konten: "<p>Tekanan adalah gaya yang bekerja pada suatu luas permukaan. Pisau tajam karena luas permukaannya sangat kecil, sehingga tekanannya besar.</p>", funFact: "Kapal selam dapat menyelam dan mengapung dengan mengatur jumlah air di dalam tangki pemberatnya, sesuai prinsip Archimedes.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Mengapa paku yang ujungnya runcing lebih mudah menancap?", pilihan: ["Karena gayanya lebih besar", "Karena tekanannya lebih besar", "Karena bahannya lebih kuat"], jawaban: "Karena tekanannya lebih besar", hint: "Luas permukaan kecil, tekanan besar." }] },
                            getaran_gelombang: { judul: "Getaran dan Gelombang", konten: "<p>Getaran adalah gerak bolak-balik. Gelombang adalah getaran yang merambat dan membawa energi, seperti gelombang suara dan cahaya.</p>", funFact: "Suara tidak dapat merambat di ruang hampa, karena tidak ada medium untuk bergetar.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Contoh gelombang transversal adalah...", pilihan: ["Gelombang suara", "Gelombang cahaya", "Gelombang pada pegas"], jawaban: "Gelombang cahaya", hint: "Arah getarnya tegak lurus dengan arah rambatnya." }] },
                            optik: { judul: "Cermin dan Lensa", konten: "<p>Optik mempelajari cahaya. Cermin memantulkan cahaya, sedangkan lensa membiaskan cahaya. Digunakan pada kacamata dan teleskop.</p>", funFact: "Pelangi adalah contoh dari peristiwa dispersi, yaitu penguraian cahaya putih menjadi berbagai warna.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Untuk membantu penderita rabun jauh (miopi), digunakan kacamata berlensa...", pilihan: ["Cekung", "Cembung", "Datar"], jawaban: "Cekung", hint: "Lensa negatif." }] },
                            listrik: { judul: "Arus Listrik", konten: "<p>Listrik dinamis adalah aliran elektron dalam suatu rangkaian tertutup. Ada rangkaian seri dan paralel.</p>", funFact: "Belut listrik dapat menghasilkan sengatan hingga 600 volt untuk melumpuhkan mangsanya.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Pada rangkaian seri, jika satu lampu mati, maka lampu lain akan...", pilihan: ["Tetap menyala", "Makin terang", "Ikut mati"], jawaban: "Ikut mati", hint: "Karena alirannya terputus." }] },
                            suhu_kalor: { judul: "Panas dan Dingin", konten: "<p>Suhu adalah ukuran derajat panas. Kalor adalah energi panas yang berpindah dari benda bersuhu tinggi ke rendah. Perpindahan bisa secara konduksi, konveksi, atau radiasi.</p>", funFact: "Warna putih memantulkan panas lebih baik daripada warna hitam, itulah sebabnya kita merasa lebih sejuk memakai baju putih di hari yang panas.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Asap api unggun yang bergerak ke atas adalah contoh perpindahan panas secara...", pilihan: ["Konduksi", "Konveksi", "Radiasi"], jawaban: "Konveksi", hint: "Perpindahan panas melalui aliran zat." }] },
                            kemagnetan: { judul: "Medan Magnet", konten: "<p>Magnet menghasilkan medan magnet di sekitarnya. Bumi sendiri adalah magnet raksasa yang melindungi kita dari radiasi matahari.</p>", funFact: "Beberapa hewan, seperti burung merpati dan penyu, menggunakan medan magnet bumi untuk navigasi saat bermigrasi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Jika dua kutub magnet yang sama didekatkan, akan terjadi...", pilihan: ["Tarik-menarik", "Tolak-menolak", "Tidak ada interaksi"], jawaban: "Tolak-menolak", hint: "Utara dengan utara, atau selatan dengan selatan." }] },
                            tata_surya: { judul: "Jelajah Antariksa", konten: "<p>Tata surya kita terdiri dari Matahari sebagai pusat, dan planet-planet yang mengorbitnya karena gaya gravitasi.</p>", funFact: "Satu hari di Venus lebih lama daripada satu tahun di Venus. Rotasinya sangat lambat!", kuis: [{ type: "pilihan-ganda", pertanyaan: "Planet yang terkenal dengan cincinnya adalah...", pilihan: ["Jupiter", "Mars", "Saturnus"], jawaban: "Saturnus", hint: "Planet terbesar kedua di tata surya." }] }
                        }
                    },
                     // Dunia-dunia tambahan untuk SMP
                    kimia_smp: { namaDunia: "Dapur Kimia", warna: "orange", icon: "ğŸ§ª", deskripsi: "Mengenal unsur, senyawa, dan reaksi yang membentuk dunia kita.", subMateri: { /* 10 sub-materi */ } },
                    pkn_smp: { namaDunia: "Parlemen Muda", warna: "indigo", icon: "âš–ï¸", deskripsi: "Mempelajari dasar-dasar negara, hukum, dan demokrasi.", subMateri: { /* 10 sub-materi */ } },
                    sejarah_smp: { namaDunia: "Kronik Sejarah Nusantara", warna: "stone", icon: "ğŸ“œ", deskripsi: "Menelusuri jejak masa penjajahan hingga kemerdekaan Indonesia.", subMateri: { /* 10 sub-materi */ } },
                    geografi_smp: { namaDunia: "Atlas Dunia", warna: "emerald", icon: "ğŸŒ", deskripsi: "Menjelajahi benua, iklim, dan interaksi manusia dengan lingkungan.", subMateri: { /* 10 sub-materi */ } },
                    sastra_smp: { namaDunia: "Panggung Sastra", warna: "rose", icon: "ğŸ­", deskripsi: "Menganalisis puisi, cerpen, dan novel karya sastrawan Indonesia.", subMateri: { /* 10 sub-materi */ } },
                    inggris_smp: { namaDunia: "English Harbour", warna: "teal", icon: "âš“", deskripsi: "Menguasai grammar, tenses, dan percakapan Bahasa Inggris.", subMateri: { /* 10 sub-materi */ } },
                    ekonomi_smp: { namaDunia: "Bursa Ekonomi", warna: "lime", icon: "ğŸ“ˆ", deskripsi: "Memahami konsep permintaan, penawaran, dan kegiatan ekonomi.", subMateri: { /* 10 sub-materi */ } }
                }
            },
            sma: {
                dunia: {
                    kalkulus_sma: {
                        namaDunia: "Kalkulus Kosmos", warna: "purple", icon: "âˆ¬", deskripsi: "Menggunakan matematika tingkat lanjut untuk memahami perubahan dan tak hingga.",
                        subMateri: {
                            limit: { judul: "Gerbang Menuju Tak Hingga", konten: "<p>Limit adalah nilai yang 'didekati' oleh suatu fungsi saat inputnya mendekati suatu nilai tertentu. Konsep ini menjadi fondasi dari turunan dan integral.</p>", funFact: "Konsep limit sudah ada sejak zaman Yunani kuno, tetapi baru diformalkan pada abad ke-19.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Limit dari f(x) = x + 2 saat x mendekati 3 adalah?", pilihan: ["3", "Tak hingga", "5"], jawaban: "5", hint: "Substitusikan saja nilai x = 3 ke dalam fungsi." }] },
                            turunan: { judul: "Laju Perubahan Sesaat", konten: "<p>Turunan (diferensial) mengukur laju perubahan sesaat dari suatu fungsi. Dalam fisika, turunan dari posisi adalah kecepatan.</p>", funFact: "Isaac Newton dan Gottfried Leibniz secara independen mengembangkan kalkulus pada abad ke-17.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Turunan pertama dari f(x) = 3xÂ² adalah...", pilihan: ["6x", "3x", "xÂ²"], jawaban: "6x", hint: "Gunakan aturan pangkat: n*x^(n-1)." }] },
                            integral: { judul: "Menghitung Luas di Bawah Kurva", konten: "<p>Integral adalah kebalikan dari turunan (anti-turunan). Integral tentu digunakan untuk menghitung luas area di bawah kurva.</p>", funFact: "Integral sangat penting dalam bidang teknik untuk menghitung volume benda putar dan pusat massa.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Integral dari f(x) = 2x adalah...", pilihan: ["xÂ² + C", "2 + C", "x + C"], jawaban: "xÂ² + C", hint: "Kebalikan dari turunan. Jangan lupa konstanta C." }] },
                            trigonometri_lanjut: { judul: "Identitas Trigonometri", konten: "<p>Trigonometri lanjut membahas identitas seperti sinÂ²x + cosÂ²x = 1, serta persamaan dan fungsi trigonometri yang kompleks.</p>", funFact: "Trigonometri awalnya dikembangkan untuk keperluan astronomi dan navigasi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Jika sinÂ²x + cosÂ²x = 1, maka 1 - sinÂ²x sama dengan...", pilihan: ["cosÂ²x", "sin x", "1"], jawaban: "cosÂ²x", hint: "Pindahkan sinÂ²x ke ruas kanan." }] },
                            matriks: { judul: "Matriks dan Transformasi", konten: "<p>Matriks adalah susunan bilangan dalam baris dan kolom. Matriks dapat digunakan untuk menyelesaikan sistem persamaan linear dan melakukan transformasi geometri.</p>", funFact: "Matriks digunakan dalam grafika komputer untuk memutar, memperbesar, dan memindahkan objek 3D.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Matriks yang hasil perkaliannya dengan matriks lain tidak mengubah matriks tersebut adalah matriks...", pilihan: ["Nol", "Identitas", "Transpose"], jawaban: "Identitas", hint: "Seperti angka 1 dalam perkalian biasa." }] },
                            vektor: { judul: "Besaran dan Arah", konten: "<p>Vektor adalah besaran yang memiliki nilai dan arah, seperti kecepatan dan gaya. Berbeda dengan skalar yang hanya memiliki nilai.</p>", funFact: "GPS menggunakan prinsip vektor untuk menghitung posisi dan rute perjalanan Anda.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Manakah dari berikut ini yang merupakan besaran vektor?", pilihan: ["Suhu", "Jarak", "Perpindahan"], jawaban: "Perpindahan", hint: "Memperhatikan arah gerak." }] },
                            dimensi_tiga: { judul: "Jarak dalam Ruang", konten: "<p>Geometri dimensi tiga mempelajari hubungan titik, garis, dan bidang dalam ruang, seperti menghitung jarak dan sudut pada kubus atau limas.</p>", funFact: "Seniman Renaissance seperti Leonardo da Vinci adalah pionir dalam menggunakan prinsip geometri 3D untuk menciptakan ilusi kedalaman pada lukisan.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Garis lurus terpanjang di dalam sebuah kubus adalah...", pilihan: ["Rusuk", "Diagonal sisi", "Diagonal ruang"], jawaban: "Diagonal ruang", hint: "Menghubungkan dua titik sudut yang berlawanan." }] },
                            program_linear: { judul: "Optimasi Sumber Daya", konten: "<p>Program linear adalah metode matematika untuk menemukan nilai optimum (maksimum atau minimum) dari suatu masalah dengan batasan-batasan tertentu.</p>", funFact: "Program linear banyak digunakan dalam bisnis untuk memaksimalkan keuntungan atau meminimalkan biaya produksi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Tujuan utama program linear adalah menemukan nilai...", pilihan: ["Rata-rata", "Tengah", "Optimum"], jawaban: "Optimum", hint: "Bisa maksimum atau minimum." }] },
                            transformasi_geometri: { judul: "Geser, Putar, Cermin", konten: "<p>Transformasi geometri adalah perubahan posisi atau ukuran suatu objek. Meliputi translasi (pergeseran), rotasi (perputaran), refleksi (pencerminan), dan dilatasi (perbesaran).</p>", funFact: "Pola pada kain batik seringkali menggunakan prinsip transformasi geometri, terutama refleksi dan translasi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Transformasi yang mengubah ukuran objek adalah...", pilihan: ["Translasi", "Rotasi", "Dilatasi"], jawaban: "Dilatasi", hint: "Membuat lebih besar atau lebih kecil." }] },
                            peluang_lanjut: { judul: "Kaidah Pencacahan", konten: "<p>Peluang lanjut membahas kaidah pencacahan, permutasi (urutan penting), dan kombinasi (urutan tidak penting) untuk menghitung kemungkinan.", funFact: "Jumlah kemungkinan susunan setumpuk 52 kartu remi lebih banyak daripada jumlah atom di Bumi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Memilih 3 juara dari 10 finalis adalah contoh dari...", pilihan: ["Permutasi", "Kombinasi", "Faktorial"], jawaban: "Permutasi", hint: "Karena urutan juara 1, 2, dan 3 itu penting." }] }
                        }
                    },
                    fisika_sma: {
                        namaDunia: "Reaktor Fisika Kuantum", warna: "red", icon: "ğŸ’¥", deskripsi: "Menjelajahi dunia partikel sub-atomik dan hukum fisika modern.",
                        subMateri: {
                            relativitas: { judul: "Ruang-Waktu Einstein", konten: "<p>Teori relativitas khusus Einstein menyatakan bahwa ruang dan waktu bersifat relatif, dan kecepatan cahaya adalah konstan bagi semua pengamat.</p>", funFact: "Karena efek relativitas, waktu berjalan sedikit lebih lambat bagi astronot di luar angkasa dibandingkan di Bumi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Menurut Einstein, apa yang terjadi pada massa benda saat bergerak mendekati kecepatan cahaya?", pilihan: ["Berkurang", "Tetap", "Bertambah"], jawaban: "Bertambah", hint: "Energi dan massa setara (E=mcÂ²)." }] },
                            radiasi_benda_hitam: { judul: "Radiasi Benda Hitam", konten: "<p>Benda hitam ideal menyerap semua radiasi. Spektrum radiasinya hanya bergantung pada suhu. Fenomena ini melahirkan fisika kuantum.</p>", funFact: "Matahari dan bintang-bintang lain dapat dianggap sebagai benda hitam yang hampir sempurna.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Hukum yang menjelaskan puncak spektrum radiasi benda hitam bergeser ke panjang gelombang lebih pendek saat suhu meningkat adalah...", pilihan: ["Hukum Stefan-Boltzmann", "Hukum Pergeseran Wien", "Hukum Planck"], jawaban: "Hukum Pergeseran Wien", hint: "Wien's Displacement Law." }] },
                            efek_fotolistrik: { judul: "Cahaya sebagai Partikel", konten: "<p>Efek fotolistrik adalah keluarnya elektron dari logam saat disinari cahaya. Ini membuktikan bahwa cahaya memiliki sifat partikel (foton).</p>", funFact: "Albert Einstein memenangkan Hadiah Nobel bukan untuk teori relativitas, melainkan untuk penjelasannya tentang efek fotolistrik.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Energi satu foton (partikel cahaya) sebanding dengan...", pilihan: ["Amplitudo", "Frekuensi", "Panjang gelombang"], jawaban: "Frekuensi", hint: "E = hf, di mana h adalah konstanta Planck." }] },
                            model_atom: { judul: "Model Atom Modern", konten: "<p>Model atom berkembang dari Dalton, Thomson, Rutherford, Bohr, hingga model mekanika kuantum yang menyatakan elektron berada dalam orbital (awan probabilitas).</p>", funFact: "Jika inti atom sebesar kelereng, maka elektron terdekat akan berada sejauh setengah kilometer!", kuis: [{ type: "pilihan-ganda", pertanyaan: "Model atom yang menggambarkan elektron mengorbit inti seperti planet mengelilingi matahari adalah model...", pilihan: ["Thomson", "Rutherford", "Bohr"], jawaban: "Rutherford", hint: "Model roti kismis digagas oleh Thomson." }] },
                            dualisme_gelombang_partikel: { judul: "Sifat Ganda Materi", konten: "<p>Louis de Broglie mengemukakan bahwa semua materi, termasuk elektron, memiliki sifat ganda, yaitu bisa bersifat sebagai partikel dan juga sebagai gelombang.</p>", funFact: "Sifat gelombang dari elektron dimanfaatkan dalam mikroskop elektron untuk melihat objek yang sangat kecil.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Hipotesis de Broglie menyatakan bahwa panjang gelombang suatu partikel...", pilihan: ["Berbanding lurus dengan momentumnya", "Berbanding terbalik dengan momentumnya", "Tidak bergantung pada momentumnya"], jawaban: "Berbanding terbalik dengan momentumnya", hint: "Î» = h/p." }] },
                            fisika_inti: { judul: "Energi dari Inti Atom", konten: "<p>Fisika inti mempelajari tentang inti atom. Reaksi fisi (pembelahan inti) dan fusi (penggabungan inti) melepaskan energi yang sangat besar.</p>", funFact: "Reaksi fusi adalah sumber energi Matahari dan bintang-bintang.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Reaksi yang terjadi pada Pembangkit Listrik Tenaga Nuklir (PLTN) adalah...", pilihan: ["Fisi", "Fusi", "Peluruhan beta"], jawaban: "Fisi", hint: "Pembelahan inti Uranium." }] },
                            termodinamika: { judul: "Hukum Panas dan Energi", konten: "<p>Termodinamika mempelajari hubungan antara panas, kerja, dan energi. Hukum kedua menyatakan bahwa entropi (ketidakteraturan) semesta selalu bertambah.</p>", funFact: "Tidak mungkin membuat mesin yang 100% efisien mengubah panas menjadi kerja, ini adalah salah satu konsekuensi dari Hukum Kedua Termodinamika.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Hukum pertama termodinamika pada dasarnya adalah pernyataan dari hukum kekekalan...", pilihan: ["Momentum", "Massa", "Energi"], jawaban: "Energi", hint: "Energi tidak dapat diciptakan atau dimusnahkan." }] },
                            gelombang_elektromagnetik: { judul: "Spektrum Tak Terlihat", konten: "<p>Spektrum gelombang elektromagnetik meliputi gelombang radio, mikro, inframerah, cahaya tampak, ultraviolet, sinar-X, dan sinar gamma.</p>", funFact: "Wi-Fi, Bluetooth, dan sinyal ponsel Anda semuanya adalah bentuk gelombang radio.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Gelombang elektromagnetik dengan energi paling tinggi adalah...", pilihan: ["Gelombang Radio", "Cahaya Tampak", "Sinar Gamma"], jawaban: "Sinar Gamma", hint: "Memiliki frekuensi tertinggi." }] },
                            arus_bolak_balik: { judul: "Listrik di Rumah Kita", konten: "<p>Arus bolak-balik (AC) adalah jenis listrik yang digunakan di rumah. Rangkaian RLC (Resistor, Induktor, Kapasitor) adalah komponen utamanya.</p>", funFact: "Perang arus ('War of Currents') antara Thomas Edison (pendukung DC) dan Nikola Tesla (pendukung AC) dimenangkan oleh AC karena lebih efisien untuk transmisi jarak jauh.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Alat yang digunakan untuk menaikkan atau menurunkan tegangan AC adalah...", pilihan: ["Kapasitor", "Transformator", "Resistor"], jawaban: "Transformator", hint: "Sering disebut trafo." }] },
                            induksi_elektromagnetik: { judul: "Magnet Menghasilkan Listrik", konten: "<p>Hukum Faraday tentang induksi elektromagnetik menyatakan bahwa perubahan medan magnet dapat menghasilkan arus listrik. Ini adalah prinsip dasar generator.", funFact: "Hampir semua listrik yang kita gunakan saat ini dibangkitkan menggunakan prinsip induksi elektromagnetik.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Prinsip kerja dinamo sepeda didasarkan pada...", pilihan: ["Efek fotolistrik", "Induksi elektromagnetik", "Hukum Ohm"], jawaban: "Induksi elektromagnetik", hint: "Perputaran magnet di dekat kumparan." }] }
                        }
                    },
                    kimia_sma: {
                        namaDunia: "Sintesis Kimia Organik", warna: "lime", icon: "âš—ï¸", deskripsi: "Mempelajari senyawa berbasis karbon yang menjadi dasar kehidupan.",
                        subMateri: {
                            atom_karbon: { judul: "Keunikan Atom Karbon", konten: "<p>Atom karbon dapat membentuk empat ikatan kovalen yang stabil, memungkinkannya membentuk rantai dan cincin kompleks, dasar dari semua molekul organik.</p>", funFact: "Bentuk alotropi karbon termasuk grafit (pada pensil), intan (permata terkeras), dan graphene (bahan satu atom tertipis).", kuis: [{ type: "pilihan-ganda", pertanyaan: "Berapa jumlah ikatan yang dapat dibentuk oleh satu atom karbon?", pilihan: ["2", "4", "6"], jawaban: "4", hint: "Elektron valensinya ada 4." }] },
                            hidrokarbon: { judul: "Alkana, Alkena, Alkuna", konten: "<p>Hidrokarbon adalah senyawa paling sederhana yang hanya terdiri dari hidrogen dan karbon. Alkana (ikatan tunggal), Alkena (ikatan rangkap dua), Alkuna (ikatan rangkap tiga).</p>", funFact: "Gas alam dan minyak bumi sebagian besar adalah campuran dari berbagai senyawa hidrokarbon.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Senyawa Câ‚‚Hâ‚„ termasuk dalam deret homolog...", pilihan: ["Alkana", "Alkena", "Alkuna"], jawaban: "Alkena", hint: "Mengikuti rumus CnH2n." }] },
                            gugus_fungsi_alkohol: { judul: "Alkohol dan Eter", konten: "<p>Gugus fungsi adalah atom atau kelompok atom yang memberikan sifat khas pada senyawa. Gugus -OH adalah alkohol, sedangkan -O- adalah eter.</p>", funFact: "Etanol adalah jenis alkohol yang ditemukan dalam minuman, sementara metanol sangat beracun.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Senyawa dengan gugus fungsi -OH disebut...", pilihan: ["Eter", "Alkohol", "Aldehid"], jawaban: "Alkohol", hint: "Contohnya metanol, etanol." }] },
                            aldehid_keton: { judul: "Aldehid dan Keton", konten: "<p>Keduanya memiliki gugus karbonil (C=O). Pada aldehid, gugus karbonil ada di ujung rantai, sedangkan pada keton ada di tengah.</p>", funFact: "Formalin, yang digunakan untuk mengawetkan spesimen biologi, adalah nama dagang dari larutan formaldehid (suatu aldehid).", kuis: [{ type: "pilihan-ganda", pertanyaan: "Aseton, yang digunakan sebagai penghapus cat kuku, adalah contoh senyawa...", pilihan: ["Aldehid", "Keton", "Asam karboksilat"], jawaban: "Keton", hint: "Nama IUPAC-nya adalah propanon." }] },
                            asam_karboksilat_ester: { judul: "Asam dan Aroma", konten: "<p>Asam karboksilat (-COOH) bersifat asam. Ester (-COO-) terbentuk dari reaksi asam karboksilat dan alkohol, dan seringkali memiliki aroma buah.", funFact: "Aroma pisang, nanas, dan apel pada perasa buatan berasal dari senyawa ester yang berbeda.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Asam cuka atau asam asetat termasuk dalam golongan...", pilihan: ["Ester", "Alkohol", "Asam karboksilat"], jawaban: "Asam karboksilat", hint: "Rumusnya CHâ‚ƒCOOH." }] },
                            benzena: { judul: "Cincin Aromatik Benzena", konten: "<p>Benzena (Câ‚†Hâ‚†) adalah senyawa siklik dengan ikatan rangkap terkonjugasi yang sangat stabil. Banyak senyawa turunan benzena penting dalam industri.</p>", funFact: "Struktur cincin benzena pertama kali diusulkan oleh August KekulÃ© setelah bermimpi tentang seekor ular yang menggigit ekornya sendiri.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Senyawa turunan benzena yang digunakan sebagai bahan peledak adalah...", pilihan: ["Fenol", "Anilina", "TNT (Trinitrotoluena)"], jawaban: "TNT (Trinitrotoluena)", hint: "Singkatan dari Trinitrotoluena." }] },
                            polimer: { judul: "Rantai Raksasa Polimer", konten: "<p>Polimer adalah molekul raksasa (makromolekul) yang terbentuk dari pengulangan unit-unit kecil (monomer). Contohnya plastik, nilon, dan karet.</p>", funFact: "DNA dan protein dalam tubuh kita juga merupakan contoh polimer alami.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Plastik PET yang digunakan untuk botol minuman adalah contoh...", pilihan: ["Monomer", "Polimer", "Isomer"], jawaban: "Polimer", hint: "Terbentuk dari banyak unit monomer." }] },
                            karbohidrat: { judul: "Sumber Energi: Karbohidrat", konten: "<p>Karbohidrat adalah biomolekul yang terdiri dari atom C, H, dan O. Berfungsi sebagai sumber energi utama. Contoh: glukosa, sukrosa, amilum.</p>", funFact: "Selulosa, karbohidrat yang menyusun dinding sel tumbuhan, adalah senyawa organik paling melimpah di Bumi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Gula pasir yang kita gunakan sehari-hari adalah...", pilihan: ["Glukosa", "Fruktosa", "Sukrosa"], jawaban: "Sukrosa", hint: "Sebuah disakarida." }] },
                            protein_lemak: { judul: "Pembangun Tubuh: Protein & Lemak", konten: "<p>Protein adalah polimer dari asam amino, berfungsi sebagai pembangun sel dan enzim. Lemak (lipid) berfungsi sebagai cadangan energi dan pelarut vitamin.</p>", funFact: "Bentuk tiga dimensi dari protein sangat menentukan fungsinya. Perubahan bentuk sedikit saja bisa membuatnya tidak aktif.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Monomer atau unit penyusun protein adalah...", pilihan: ["Glukosa", "Asam amino", "Asam lemak"], jawaban: "Asam amino", hint: "Ada 20 jenis asam amino esensial." }] },
                            redoks_elektrokimia: { judul: "Sel Volta dan Elektrolisis", konten: "<p>Elektrokimia mempelajari hubungan antara reaksi kimia dan energi listrik. Sel Volta mengubah energi kimia menjadi listrik (baterai), sedangkan elektrolisis sebaliknya.</p>", funFact: "Proses penyepuhan logam, seperti melapisi sendok dengan perak, menggunakan prinsip elektrolisis.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Pada sel Volta (baterai), energi kimia diubah menjadi energi...", pilihan: ["Panas", "Cahaya", "Listrik"], jawaban: "Listrik", hint: "Menghasilkan arus listrik spontan." }] }
                        }
                    },
                     // Dunia-dunia tambahan untuk SMA
                    biologi_sma: { namaDunia: "Molekul Kehidupan", warna: "emerald", icon: "ğŸ¦ ", deskripsi: "Mendalami genetika, evolusi, dan bioteknologi modern.", subMateri: { /* 10 sub-materi */ } },
                    sosiologi_sma: { namaDunia: "Agora Sosiologi", warna: "cyan", icon: "ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦", deskripsi: "Menganalisis struktur, konflik, dan perubahan dalam masyarakat.", subMateri: { /* 10 sub-materi */ } },
                    ekonomi_sma: { namaDunia: "Pasar Modal Global", warna: "amber", icon: "ğŸ’°", deskripsi: "Mengupas tuntas makroekonomi, kebijakan fiskal, dan perdagangan internasional.", subMateri: { /* 10 sub-materi */ } },
                    geografi_sma: { namaDunia: "Geopolitik Dunia", warna: "teal", icon: "ğŸŒ", deskripsi: "Memahami isu-isu global, interaksi negara, dan sistem informasi geografis.", subMateri: { /* 10 sub-materi */ } },
                    sejarah_sma: { namaDunia: "Peradaban Dunia", warna: "stone", icon: "ğŸ›ï¸", deskripsi: "Menelusuri sejarah peradaban dunia dari zaman kuno hingga era modern.", subMateri: { /* 10 sub-materi */ } },
                    sastra_sma: { namaDunia: "Literary Circle", warna: "rose", icon: "ğŸ“–", deskripsi: "Mengkaji karya sastra dunia dan teori-teori kritik sastra.", subMateri: { /* 10 sub-materi */ } },
                    tik_sma: { namaDunia: "Studio Informatika", warna: "slate", icon: "ğŸ‘¨â€ğŸ’»", deskripsi: "Mempelajari algoritma, logika pemrograman, dan dampak sosial teknologi.", subMateri: { /* 10 sub-materi */ } }
                }
            },
            kuliah: {
                dunia: {
                    filsafat_kuliah: {
                        namaDunia: "Fakultas Filsafat", warna: "stone", icon: "ğŸ¤”", deskripsi: "Menggali pertanyaan mendasar tentang eksistensi, pengetahuan, dan etika.",
                        subMateri: {
                            rasionalisme_empirisme: { judul: "Akal vs Pengalaman", konten: "<p>Rasionalisme (Plato, Descartes) berpendapat bahwa pengetahuan sejati berasal dari akal budi (reason). Empirisme (Aristoteles, Locke) berpendapat pengetahuan berasal dari pengalaman indrawi (experience).</p>", funFact: "Perdebatan antara rasionalisme dan empirisme membentuk dasar dari sebagian besar filsafat Barat modern.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Filusuf yang terkenal dengan ucapan 'Aku berpikir, maka aku ada' ('Cogito, ergo sum') adalah penganut aliran?", pilihan: ["Empirisme", "Rasionalisme", "Eksistensialisme"], jawaban: "Rasionalisme", hint: "Mendahulukan akal di atas segalanya." }] },
                            metafisika: { judul: "Hakikat Realitas", konten: "<p>Metafisika adalah cabang filsafat yang mempertanyakan hakikat dasar dari realitas. Apa itu 'ada'? Apa itu ruang dan waktu?</p>", funFact: "Nama 'metafisika' berasal dari karya Aristoteles yang secara harfiah ditempatkan 'setelah fisika' (meta ta physika) dalam koleksi tulisannya.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Studi filosofis tentang 'keberadaan' atau 'being' disebut...", pilihan: ["Epistemologi", "Etika", "Ontologi"], jawaban: "Ontologi", hint: "Ini adalah cabang utama dari metafisika." }] },
                            etika: { judul: "Baik dan Buruk", konten: "<p>Etika mempelajari prinsip-prinsip moral. Deontologi (Kant) fokus pada kewajiban, sementara Utilitarianisme (Bentham, Mill) fokus pada hasil atau konsekuensi yang paling menguntungkan banyak orang.</p>", funFact: "Dilema troli (Trolley Problem) adalah eksperimen pikiran yang sering digunakan untuk menguji intuisi etis antara deontologi dan utilitarianisme.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Aliran etika yang menilai tindakan berdasarkan hasilnya adalah...", pilihan: ["Deontologi", "Etika Kebajikan", "Utilitarianisme"], jawaban: "Utilitarianisme", hint: "The greatest good for the greatest number." }] },
                            epistemologi: { judul: "Batas Pengetahuan", konten: "<p>Epistemologi adalah cabang filsafat yang berfokus pada pengetahuan itu sendiri. Apa itu pengetahuan? Bagaimana kita mendapatkannya? Apa yang bisa kita ketahui?</p>", funFact: "Masalah Gettier adalah tantangan terkenal dalam epistemologi yang mempertanyakan definisi klasik pengetahuan sebagai 'kepercayaan sejati yang dapat dibenarkan'.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Cabang filsafat yang mempelajari tentang pengetahuan disebut...", pilihan: ["Metafisika", "Epistemologi", "Estetika"], jawaban: "Epistemologi", hint: "Berasal dari kata Yunani 'episteme' (pengetahuan)." }] },
                            filsafat_politik: { judul: "Kontrak Sosial", konten: "<p>Teori kontrak sosial (Hobbes, Locke, Rousseau) berpendapat bahwa negara dan otoritas pemerintah dibenarkan karena adanya persetujuan (kontrak) dari individu untuk keluar dari 'keadaan alamiah'.</p>", funFact: "Thomas Hobbes menggambarkan keadaan alamiah sebagai 'perang semua melawan semua', di mana hidup itu 'soliter, miskin, keji, brutal, dan singkat'.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Filusuf yang berpendapat manusia lahir sebagai 'tabula rasa' atau kertas kosong adalah...", pilihan: ["Hobbes", "Locke", "Rousseau"], jawaban: "Locke", hint: "Gagasannya sangat mempengaruhi deklarasi kemerdekaan AS." }] },
                            eksistensialisme: { judul: "Eksistensi Mendahului Esensi", konten: "<p>Eksistensialisme (Sartre, Camus) adalah aliran filsafat yang menekankan kebebasan individu, tanggung jawab, dan subjektivitas. Manusia pertama-tama ada, baru kemudian mendefinisikan dirinya sendiri.</p>", funFact: "Jean-Paul Sartre pernah menolak Hadiah Nobel Sastra karena ia tidak ingin 'diubah' oleh institusi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Konsep utama dalam eksistensialisme yang menyatakan bahwa hidup tidak memiliki makna inheren adalah...", pilihan: ["Absurdisme", "Nihilisme", "Determinisme"], jawaban: "Absurdisme", hint: "Terutama dikaitkan dengan Albert Camus." }] },
                            post_strukturalisme: { judul: "Dekonstruksi Makna", konten: "<p>Post-strukturalisme (Derrida, Foucault) mengkritik gagasan bahwa ada struktur universal yang stabil dalam makna, bahasa, dan masyarakat. Mereka menekankan ketidakstabilan makna.</p>", funFact: "Jacques Derrida memperkenalkan konsep 'dekonstruksi', yaitu membongkar teks untuk melihat asumsi-asumsi yang tersembunyi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Michel Foucault terkenal dengan analisisnya tentang hubungan antara pengetahuan dan...", pilihan: ["Ekonomi", "Kekuasaan", "Seni"], jawaban: "Kekuasaan", hint: "Knowledge is power." }] },
                            logika: { judul: "Seni Berpikir Lurus", konten: "<p>Logika adalah studi tentang penalaran yang valid. Silogisme Aristoteles adalah contoh klasik: Jika semua manusia fana (premis 1) dan Socrates adalah manusia (premis 2), maka Socrates fana (kesimpulan).</p>", funFact: "Kesalahan logika (logical fallacy) seperti 'ad hominem' (menyerang orangnya, bukan argumennya) sering terjadi dalam debat sehari-hari.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Kesimpulan yang ditarik dari dua premis atau lebih disebut...", pilihan: ["Proposisi", "Argumen", "Deduksi"], jawaban: "Deduksi", hint: "Dari umum ke khusus." }] },
                            filsafat_timur: { judul: "Jalan Tao dan Zen", konten: "<p>Filsafat Timur, seperti Taoisme dan Zen Buddhisme, seringkali lebih fokus pada harmoni, keseimbangan, dan pengalaman langsung daripada analisis logis Barat.</p>", funFact: "Konsep Yin dan Yang dalam Taoisme melambangkan dualitas yang saling melengkapi dan membentuk keseluruhan yang seimbang.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Konsep 'Wu Wei' dalam Taoisme berarti...", pilihan: ["Bekerja keras", "Tindakan tanpa usaha (effortless action)", "Meditasi mendalam"], jawaban: "Tindakan tanpa usaha (effortless action)", hint: "Mengalir bersama alam." }] },
                            estetika: { judul: "Apa itu Keindahan?", konten: "<p>Estetika adalah cabang filsafat yang membahas sifat seni, keindahan, dan selera. Apakah keindahan itu objektif atau subjektif?</p>", funFact: "Immanuel Kant berpendapat bahwa penilaian keindahan bersifat subjektif namun universal, artinya kita berharap orang lain setuju dengan kita.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Konsep 'katarsis' atau pemurnian emosi melalui seni pertama kali diperkenalkan oleh...", pilihan: ["Plato", "Aristoteles", "Nietzsche"], jawaban: "Aristoteles", hint: "Dalam konteks drama tragedi Yunani." }] }
                        }
                    },
                    psikologi_kuliah: {
                        namaDunia: "Kajian Psikologi", warna: "fuchsia", icon: "ğŸ§ ", deskripsi: "Memahami pikiran, perasaan, dan perilaku manusia melalui berbagai teori.",
                        subMateri: {
                            psikoanalisis: { judul: "Peta Pikiran Freud", konten: "<p>Sigmund Freud memperkenalkan konsep ketidaksadaran (unconscious mind) serta struktur kepribadian id, ego, dan superego yang mempengaruhi perilaku manusia.</p>", funFact: "Freud percaya bahwa mimpi adalah 'jalan utama menuju alam bawah sadar'.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Menurut Freud, bagian kepribadian yang bekerja berdasarkan prinsip kesenangan (pleasure principle) adalah?", pilihan: ["Ego", "Superego", "Id"], jawaban: "Id", hint: "Dorongan paling dasar dan primitif." }] },
                            behaviorisme: { judul: "Belajar dari Lingkungan", konten: "<p>Behaviorisme (Pavlov, Skinner) berfokus pada perilaku yang dapat diamati dan bagaimana perilaku itu dibentuk oleh lingkungan melalui pengkondisian (conditioning).</p>", funFact: "Eksperimen 'Anjing Pavlov' menunjukkan bahwa respons fisiologis seperti mengeluarkan air liur dapat dikondisikan terhadap rangsangan netral seperti bunyi bel.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Dalam 'Skinner Box', seekor tikus belajar menekan tuas untuk mendapatkan makanan. Ini adalah contoh dari...", pilihan: ["Pengkondisian Klasik", "Pengkondisian Operan", "Belajar Laten"], jawaban: "Pengkondisian Operan", hint: "Perilaku dikendalikan oleh konsekuensi (ganjaran/hukuman)." }] },
                            humanisme: { judul: "Potensi Diri Manusia", konten: "<p>Psikologi Humanistik (Maslow, Rogers) menentang pandangan pesimistis psikoanalisis dan behaviorisme, dengan fokus pada kehendak bebas, pertumbuhan pribadi, dan aktualisasi diri.</p>", funFact: "Puncak dari Hierarki Kebutuhan Maslow adalah 'aktualisasi diri', yaitu pencapaian potensi penuh seseorang.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Hierarki Kebutuhan yang terkenal digagas oleh...", pilihan: ["Carl Rogers", "Abraham Maslow", "B.F. Skinner"], jawaban: "Abraham Maslow", hint: "Bentuknya seperti piramida." }] },
                            kognitif: { judul: "Revolusi Kognitif", konten: "<p>Psikologi kognitif mempelajari proses mental internal seperti berpikir, memori, persepsi, dan pemecahan masalah. Manusia dipandang sebagai pemroses informasi aktif.</p>", funFact: "Analogi pikiran sebagai komputer adalah metafora sentral dalam psikologi kognitif awal.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Studi tentang bagaimana kita memperoleh, menyimpan, dan mengambil informasi disebut studi tentang...", pilihan: ["Persepsi", "Memori", "Atensi"], jawaban: "Memori", hint: "Penyimpanan informasi di otak." }] },
                            perkembangan: { judul: "Tahapan Hidup Piaget", konten: "<p>Psikologi perkembangan mempelajari perubahan psikologis sepanjang rentang hidup. Jean Piaget terkenal dengan teori empat tahap perkembangan kognitif anak.</p>", funFact: "Menurut Piaget, anak-anak kecil belum mengembangkan 'konservasi', yaitu pemahaman bahwa kuantitas tetap sama meskipun bentuknya berubah.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Tahap perkembangan kognitif di mana anak mulai berpikir logis tentang peristiwa konkret adalah...", pilihan: ["Sensorimotor", "Praoperasional", "Operasional Konkret"], jawaban: "Operasional Konkret", hint: "Terjadi pada usia sekitar 7-11 tahun." }] },
                            sosial: { judul: "Individu dalam Kelompok", konten: "<p>Psikologi sosial mempelajari bagaimana pikiran, perasaan, dan perilaku individu dipengaruhi oleh kehadiran orang lain. Contoh: konformitas, kepatuhan, prasangka.</p>", funFact: "Eksperimen Penjara Stanford menunjukkan betapa kuatnya peran sosial dapat mempengaruhi perilaku seseorang, bahkan hingga ke tingkat ekstrem.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Kecenderungan untuk setuju dengan kelompok meskipun kita tahu itu salah disebut...", pilihan: ["Kepatuhan", "Konformitas", "Disosiasi"], jawaban: "Konformitas", hint: "Eksperimen garis Asch adalah contoh klasiknya." }] },
                            abnormal: { judul: "Kesehatan Mental", konten: "<p>Psikologi abnormal mempelajari pola perilaku, emosi, dan pikiran yang tidak biasa, yang dapat dianggap sebagai gangguan mental. DSM-5 adalah manual diagnostiknya.</p>", funFact: "Homoseksualitas pernah tercantum dalam DSM sebagai gangguan mental hingga tahun 1973.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Manual diagnostik yang digunakan secara luas untuk gangguan mental adalah...", pilihan: ["ICD-10", "DSM-5", "PPDGJ"], jawaban: "DSM-5", hint: "Diterbitkan oleh American Psychiatric Association." }] },
                            persepsi: { judul: "Melihat Dunia", konten: "<p>Sensasi adalah proses indra menerima rangsangan. Persepsi adalah proses otak mengorganisir dan menginterpretasikan sensasi tersebut menjadi sesuatu yang bermakna.</p>", funFact: "Otak kita terus-menerus membuat 'tebakan terbaik' tentang dunia luar berdasarkan informasi sensorik yang tidak lengkap, yang kadang-kadang menyebabkan ilusi optik.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Prinsip Gestalt dalam persepsi menekankan bahwa...", pilihan: ["Keseluruhan lebih dari jumlah bagian-bagiannya", "Bagian-bagian lebih penting dari keseluruhan", "Persepsi selalu akurat"], jawaban: "Keseluruhan lebih dari jumlah bagian-bagiannya", hint: "Otak kita cenderung mengorganisir menjadi pola yang utuh." }] },
                            memori: { judul: "Arsip Pikiran", konten: "<p>Memori bukanlah satu hal tunggal, melainkan sistem yang kompleks, termasuk memori sensorik, jangka pendek (working memory), dan jangka panjang (eksplisit dan implisit).</p>", funFact: "Efek 'ujung lidah' (tip-of-the-tongue) terjadi ketika kita merasa tahu suatu informasi tetapi sulit untuk mengambilnya dari memori jangka panjang.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Memori untuk keterampilan dan kebiasaan, seperti bersepeda, disebut memori...", pilihan: ["Episodik", "Semantik", "Prosedural"], jawaban: "Prosedural", hint: "Ini adalah bagian dari memori implisit (tidak sadar)." }] },
                            inteligensi: { judul: "Mengukur Kecerdasan", konten: "<p>Inteligensi adalah kemampuan untuk belajar dari pengalaman, memecahkan masalah, dan beradaptasi. Teori modern, seperti teori Howard Gardner, menyatakan ada berbagai jenis kecerdasan (multiple intelligences).</p>", funFact: "Efek Flynn adalah pengamatan bahwa skor IQ rata-rata di banyak bagian dunia meningkat secara substansial sepanjang abad ke-20.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Kecerdasan musikal dan spasial adalah bagian dari teori...", pilihan: ["Inteligensi Umum (g factor)", "Inteligensi Ganda (Multiple Intelligences)", "Inteligensi Triarkis"], jawaban: "Inteligensi Ganda (Multiple Intelligences)", hint: "Digagas oleh Howard Gardner." }] }
                        }
                    },
                    hukum_kuliah: {
                        namaDunia: "Dasar-Dasar Hukum", warna: "indigo", icon: "âš–ï¸", deskripsi: "Mengenal sistem, prinsip, dan cabang-cabang utama dalam ilmu hukum.",
                        subMateri: {
                            sistem_hukum: { judul: "Civil Law vs Common Law", konten: "<p>Sistem Civil Law (Eropa Kontinental, Indonesia) berbasis pada kodifikasi hukum tertulis. Sistem Common Law (Inggris, AS) berbasis pada preseden atau putusan hakim sebelumnya (yurisprudensi).</p>", funFact: "Negara bagian Louisiana di AS secara unik menggunakan sistem campuran antara civil law dan common law.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Sistem hukum yang dianut oleh negara Indonesia adalah...", pilihan: ["Common Law", "Civil Law", "Hukum Adat"], jawaban: "Civil Law", hint: "Warisan dari sistem hukum Belanda." }] },
                            asas_legalitas: { judul: "Asas Legalitas Pidana", konten: "<p>Asas legalitas (nullum delictum nulla poena sine praevia lege poenali) berarti tidak ada perbuatan yang dapat dihukum kecuali atas kekuatan aturan pidana dalam undang-undang yang telah ada sebelumnya.</p>", funFact: "Asas ini adalah benteng utama melawan kesewenang-wenangan penguasa dalam hukum pidana.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Inti dari asas legalitas adalah...", pilihan: ["Hukuman harus setimpal", "Tidak ada hukuman tanpa undang-undang sebelumnya", "Setiap orang sama di depan hukum"], jawaban: "Tidak ada hukuman tanpa undang-undang sebelumnya", hint: "Prinsip non-retroaktif." }] },
                            subjek_objek_hukum: { judul: "Subjek dan Objek Hukum", konten: "<p>Subjek hukum adalah pendukung hak dan kewajiban (manusia dan badan hukum). Objek hukum adalah segala sesuatu yang bermanfaat bagi subjek hukum dan dapat menjadi objek hubungan hukum (benda).</p>", funFact: "Di beberapa negara, ada perdebatan hukum untuk memberikan status 'subjek hukum non-manusia' kepada hewan atau bahkan alam.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Perusahaan (PT) dalam hukum dianggap sebagai...", pilihan: ["Objek Hukum", "Subjek Hukum Badan Hukum", "Subjek Hukum Manusia"], jawaban: "Subjek Hukum Badan Hukum", hint: "Dapat memiliki aset dan digugat atas namanya sendiri." }] },
                            hukum_perdata: { judul: "Hukum Perikatan", konten: "<p>Hukum perdata mengatur hubungan antar individu. Hukum Perikatan (Buku III KUHPerdata) adalah inti dari hukum perdata, mengatur tentang perjanjian (kontrak) dan perbuatan melawan hukum.</p>", funFact: "Syarat sahnya perjanjian ada empat: sepakat, cakap, suatu hal tertentu, dan sebab yang halal.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Hubungan hukum antara dua pihak atau lebih dalam bidang harta kekayaan disebut...", pilihan: ["Perkawinan", "Perikatan", "Waris"], jawaban: "Perikatan", hint: "Bisa lahir dari perjanjian atau undang-undang." }] },
                            htn: { judul: "Hukum Tata Negara", konten: "<p>Hukum Tata Negara (HTN) mempelajari negara dalam keadaan diam, yaitu tentang organisasi, struktur, dan wewenang lembaga-lembaga negara.</p>", funFact: "Konsep 'Trias Politica' (pemisahan kekuasaan legislatif, eksekutif, yudikatif) yang digagas Montesquieu adalah konsep sentral dalam HTN modern.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Lembaga negara yang memegang kekuasaan legislatif (membuat UU) di Indonesia adalah...", pilihan: ["Presiden", "Mahkamah Agung", "DPR"], jawaban: "DPR", hint: "Dewan Perwakilan Rakyat." }] },
                            han: { judul: "Hukum Administrasi Negara", konten: "<p>Hukum Administrasi Negara (HAN) mempelajari negara dalam keadaan bergerak, yaitu tentang bagaimana pemerintah menjalankan tugasnya dan hubungan hukumnya dengan warga negara.</p>", funFact: "Surat Izin Mengemudi (SIM) atau Izin Mendirikan Bangunan (IMB) adalah contoh produk dari Hukum Administrasi Negara.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Sengketa antara warga negara dengan pejabat pemerintah terkait suatu keputusan (beschikking) diselesaikan di pengadilan...", pilihan: ["Negeri", "Agama", "Tata Usaha Negara (PTUN)"], jawaban: "Tata Usaha Negara (PTUN)", hint: "Mengadili sengketa administrasi." }] },
                            hukum_internasional: { judul: "Hukum Antar Negara", konten: "<p>Hukum Internasional adalah keseluruhan kaidah dan asas hukum yang mengatur hubungan atau persoalan yang melintasi batas negara.</p>", funFact: "Sumber utama hukum internasional adalah perjanjian internasional (traktat) dan kebiasaan internasional.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Mahkamah yang mengadili kejahatan perang dan genosida adalah...", pilihan: ["Mahkamah Internasional (ICJ)", "Pengadilan Kriminal Internasional (ICC)", "Mahkamah Konstitusi"], jawaban: "Pengadilan Kriminal Internasional (ICC)", hint: "ICJ mengadili sengketa antar negara." }] },
                            hierarki_perundangan: { judul: "Tata Urutan Perundangan", konten: "<p>Ada hierarki (tata urutan) peraturan perundang-undangan, di mana peraturan yang lebih rendah tidak boleh bertentangan dengan yang lebih tinggi. UUD 1945 adalah yang tertinggi.</p>", funFact: "Jika sebuah Undang-Undang dianggap bertentangan dengan UUD 1945, ia dapat diuji materi (judicial review) di Mahkamah Konstitusi.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Dalam hierarki perundangan Indonesia, yang kedudukannya paling tinggi adalah...", pilihan: ["Undang-Undang", "Peraturan Pemerintah", "UUD 1945"], jawaban: "UUD 1945", hint: "Konstitusi negara." }] },
                            hukum_acara: { judul: "Hukum Acara Pidana", konten: "<p>Hukum acara (hukum formil) adalah serangkaian aturan untuk menegakkan hukum materiil. Contoh: bagaimana cara polisi menyidik, jaksa menuntut, dan hakim mengadili dalam kasus pidana.</p>", funFact: "Asas 'praduga tak bersalah' (presumption of innocence) adalah pilar utama dalam hukum acara pidana modern.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Pihak yang bertugas membuktikan dakwaan terhadap terdakwa di pengadilan adalah...", pilihan: ["Hakim", "Pengacara", "Jaksa Penuntut Umum"], jawaban: "Jaksa Penuntut Umum", hint: "Mewakili negara/korban." }] },
                            teori_hukum: { judul: "Tujuan Hukum", konten: "<p>Ada berbagai teori tentang tujuan hukum. Teori Etis (Aristoteles) menyatakan tujuan hukum adalah keadilan. Teori Utilitarian (Bentham) adalah kemanfaatan. Teori Yuridis (Austin) adalah kepastian hukum.</p>", funFact: "Gustav Radbruch mencoba menyeimbangkan ketiganya, menyatakan bahwa hukum harus mengandung nilai keadilan, kemanfaatan, dan kepastian.", kuis: [{ type: "pilihan-ganda", pertanyaan: "Teori yang menyatakan tujuan hukum adalah untuk mencapai 'the greatest happiness for the greatest number' adalah teori...", pilihan: ["Etis", "Utilitarian", "Normatif"], jawaban: "Utilitarian", hint: "Fokus pada manfaat atau kegunaan." }] }
                        }
                    },
                     // Dunia-dunia tambahan untuk Kuliah
                    komunikasi_kuliah: { namaDunia: "Teori Komunikasi", warna: "cyan", icon: "ğŸ“¡", deskripsi: "Menganalisis model, media, dan dampak komunikasi dalam masyarakat.", subMateri: { /* 10 sub-materi */ } },
                    manajemen_kuliah: { namaDunia: "Manajemen Strategis", warna: "amber", icon: "ğŸ“Š", deskripsi: "Mempelajari perencanaan, analisis SWOT, dan pengambilan keputusan dalam bisnis.", subMateri: { /* 10 sub-materi */ } },
                    teknik_kuliah: { namaDunia: "Jantung Teknik Mesin", warna: "slate", icon: "âš™ï¸", deskripsi: "Memahami dasar-dasar termodinamika, statika, dan dinamika.", subMateri: { /* 10 sub-materi */ } },
                    informatika_kuliah: { namaDunia: "Arsitektur Perangkat Lunak", warna: "blue", icon: "ğŸ’¾", deskripsi: "Mempelajari siklus hidup pengembangan software dan design patterns.", subMateri: { /* 10 sub-materi */ } },
                    politik_kuliah: { namaDunia: "Ilmu Politik Modern", warna: "red", icon: "ğŸ—³ï¸", deskripsi: "Mengkaji ideologi politik, teori negara, dan sistem pemilu.", subMateri: { /* 10 sub-materi */ } },
                    kedokteran_kuliah: { namaDunia: "Klinik Kedokteran Dasar", warna: "rose", icon: "âš•ï¸", deskripsi: "Pengantar fisiologi manusia, anatomi, dan farmakologi dasar.", subMateri: { /* 10 sub-materi */ } },
                    antropologi_kuliah: { namaDunia: "Antropologi Budaya", warna: "orange", icon: "ğŸ—¿", deskripsi: "Menjelajahi relativisme budaya, etnografi, dan keragaman manusia.", subMateri: { /* 10 sub-materi */ } }
                }
            }
        };

        function generateBadges() {
            for (const jenjang in edukasiData) {
                const jenjangData = edukasiData[jenjang];
                if (!jenjangData.badges) jenjangData.badges = {};
                for (const duniaId in jenjangData.dunia) {
                    const dunia = jenjangData.dunia[duniaId];
                    jenjangData.badges[duniaId] = {
                        id: duniaId,
                        title: `Pakar ${dunia.namaDunia}`,
                        description: `Menyelesaikan semua materi di ${dunia.namaDunia}.`,
                        icon: dunia.icon
                    };
                }
                const jenjangTitle = { sd: "SD", smp: "SMP", sma: "SMA", kuliah: "Kuliah" }[jenjang];
                jenjangData.badges['cendekia'] = {
                    id: 'cendekia',
                    title: `Cendekia ${jenjangTitle}`,
                    description: `Menyelesaikan 100% materi di jenjang ${jenjangTitle}!`,
                    icon: 'ğŸ“'
                };
            }
        }
        generateBadges();


        // --- Variabel & State Aplikasi ---
        const domElements = { 
            screens: document.querySelectorAll('.screen'), 
            modals: document.querySelectorAll('.modal-overlay'),
            loadingScreen: document.getElementById('loading-screen'),
            userListContainer: document.getElementById('user-list-container'), 
            addNewUserBtn: document.getElementById('add-new-user-btn'), 
            playerNameInput: document.getElementById('player-name-input'), 
            avatarSelectionContainer: document.getElementById('avatar-selection-container'),
            nextToLevelBtn: document.getElementById('next-to-level-btn'), 
            cancelNewUserBtn: document.getElementById('cancel-new-user-btn'), 
            jenjangPromptName: document.getElementById('jenjang-prompt-name'), 
            welcomeMessage: document.getElementById('welcome-message'), 
            pointsDisplay: document.getElementById('points-display'), 
            userAvatarHeader: document.getElementById('user-avatar-header'), 
            duniaContainer: document.getElementById('dunia-container'), 
            submateriContainer: document.getElementById('submateri-container'), 
            submateriTitle: document.getElementById('submateri-title'), 
            materiContent: document.getElementById('materi-content'), 
            backToWorldsBtn: document.getElementById('back-to-worlds-btn'), 
            backToSubmateriBtn: document.getElementById('back-to-submateri-btn'), 
            settingsBtn: document.getElementById('settings-btn'), 
            achievementsBtn: document.getElementById('achievements-btn'), 
            closeSettingsBtn: document.getElementById('close-settings-btn'), 
            editNameInput: document.getElementById('edit-name-input'), 
            saveNameBtn: document.getElementById('save-name-btn'), 
            changeJenjangSelect: document.getElementById('change-jenjang-select'),
            soundToggleBtn: document.getElementById('sound-toggle'),
            themeSelector: document.getElementById('theme-selector'),
            resetProgressBtn: document.getElementById('reset-progress-btn'), 
            resetUsernameConfirm: document.getElementById('reset-username-confirm'), 
            cancelResetBtn: document.getElementById('cancel-reset-btn'), 
            confirmResetBtn: document.getElementById('confirm-reset-btn'), 
            funFactText: document.getElementById('fun-fact-text'), 
            closeFunFactBtn: document.getElementById('close-fun-fact-btn'), 
            achievementsList: document.getElementById('achievements-list'), 
            closeAchievementsBtn: document.getElementById('close-achievements-btn'), 
            certificateName: document.getElementById('certificate-name'), 
            closeCertificateBtn: document.getElementById('close-certificate-btn'),
            leaderboardBtn: document.getElementById('leaderboard-btn'),
            leaderboardList: document.getElementById('leaderboard-list'),
            closeLeaderboardBtn: document.getElementById('close-leaderboard-btn'),
            dailyMissionBtn: document.getElementById('daily-mission-btn'),
            dailyMissionText: document.getElementById('daily-mission-text'),
            missionProgressBar: document.getElementById('mission-progress-bar'),
            claimMissionRewardBtn: document.getElementById('claim-mission-reward-btn'),
            closeDailyMissionBtn: document.getElementById('close-daily-mission-btn'),
            closeDailyBonusBtn: document.getElementById('close-daily-bonus-btn'),
            avatarShopContainer: document.getElementById('avatar-shop-container'),
            closeAvatarShopBtn: document.getElementById('close-avatar-shop-btn'),
            shopPointsDisplay: document.getElementById('shop-points-display'),
            pointAnimationContainer: document.getElementById('point-animation-container'),
            streakDisplay: document.getElementById('streak-display'),
            dailyBonusAmount: document.getElementById('daily-bonus-amount'),
            dailyStreakBonusText: document.getElementById('daily-streak-bonus-text'),
            shareProgressBtn: document.getElementById('share-progress-btn'),
            mascotTipContainer: document.getElementById('mascot-tip-container'),
            musicToggleBtn: document.getElementById('music-toggle'),
            backgroundMusic: document.getElementById('background-music'),
            searchBar: document.getElementById('search-bar'),
            wordOfTheDay: document.getElementById('word-of-the-day'),
            reviewModeBtn: document.getElementById('review-mode-btn'),
            timedChallengeBtn: document.getElementById('timed-challenge-btn'),
            timedChallengeModal: document.getElementById('timed-challenge-modal'),
            challengeTimer: document.getElementById('challenge-timer'),
            challengeQuestionArea: document.getElementById('challenge-question-area'),
            challengeFeedback: document.getElementById('challenge-feedback'),
            closeTimedChallengeBtn: document.getElementById('close-timed-challenge-btn'),
            statsModal: document.getElementById('stats-modal'),
            statsUsername: document.getElementById('stats-username'),
            statsContent: document.getElementById('stats-content'),
            closeStatsBtn: document.getElementById('close-stats-btn'),
            userTitleDisplay: document.getElementById('user-title-display'),
            genericShopTitle: document.getElementById('generic-shop-title'),
            genericShopContainer: document.getElementById('generic-shop-container'),
            genericShopPoints: document.getElementById('generic-shop-points'),
            eventBannerContainer: document.getElementById('event-banner-container'),
            shareCertificateBtn: document.getElementById('share-certificate-btn'),
            progressTreeToggle: document.getElementById('progress-tree-toggle'),
        };

        let userProfiles = [], currentUserIndex = -1, activeUser = null, currentDuniaId = null, currentSubmateriId = null, selectedAvatarId = null, timedChallengeInterval = null;
        let dailyBonusWorldId = null;
        let viewedUser = null;
        const sounds = { 
            click: new Tone.Synth({ oscillator: { type: "sine" }, envelope: { attack: 0.01, decay: 0.2, sustain: 0, release: 0.1 } }).toDestination(), 
            correct: new Tone.Synth({ oscillator: { type: "triangle" }, envelope: { attack: 0.01, decay: 0.3, sustain: 0.1, release: 0.2 } }).toDestination(), 
            wrong: new Tone.Synth({ oscillator: { type: "square" }, envelope: { attack: 0.01, decay: 0.5, sustain: 0, release: 0.2 } }).toDestination(), 
            badge: new Tone.Synth({ oscillator: { type: "sawtooth" }, envelope: { attack: 0.1, decay: 0.5, sustain: 0.2, release: 0.5 } }).toDestination(),
            open: new Tone.Synth({ oscillator: { type: "sine" }, envelope: { attack: 0.01, decay: 0.1, sustain: 0, release: 0.1 } }).toDestination(),
            purchase: new Tone.Synth({ oscillator: { type: "triangle8" }, envelope: { attack: 0.01, decay: 0.4, sustain: 0.1, release: 0.2 } }).toDestination(),
            equip: new Tone.Synth({ oscillator: { type: "sine" }, envelope: { attack: 0.05, decay: 0.2, sustain: 0.2, release: 0.1 } }).toDestination(),
        };
        const colorMapping = { green: { bg: 'bg-green-100', text: 'text-green-800', border: 'border-green-400', progress: 'bg-green-500' }, emerald: { bg: 'bg-emerald-100', text: 'text-emerald-800', border: 'border-emerald-400', progress: 'bg-emerald-500' }, yellow: { bg: 'bg-yellow-100', text: 'text-yellow-800', border: 'border-yellow-400', progress: 'bg-yellow-500' }, amber: { bg: 'bg-amber-100', text: 'text-amber-800', border: 'border-amber-400', progress: 'bg-amber-500' }, blue: { bg: 'bg-blue-100', text: 'text-blue-800', border: 'border-blue-400', progress: 'bg-blue-500' }, purple: { bg: 'bg-purple-100', text: 'text-purple-800', border: 'border-purple-400', progress: 'bg-purple-500' }, violet: { bg: 'bg-violet-100', text: 'text-violet-800', border: 'border-violet-400', progress: 'bg-violet-500' }, red: { bg: 'bg-red-100', text: 'text-red-800', border: 'border-red-400', progress: 'bg-red-500' }, teal: { bg: 'bg-teal-100', text: 'text-teal-800', border: 'border-teal-400', progress: 'bg-teal-500' }, pink: { bg: 'bg-pink-100', text: 'text-pink-800', border: 'border-pink-400', progress: 'bg-pink-500' }, rose: { bg: 'bg-rose-100', text: 'text-rose-800', border: 'border-rose-400', progress: 'bg-rose-500' }, lime: { bg: 'bg-lime-100', text: 'text-lime-800', border: 'border-lime-400', progress: 'bg-lime-500' }, orange: { bg: 'bg-orange-100', text: 'text-orange-800', border: 'border-orange-400', progress: 'bg-orange-500' }, cyan: { bg: 'bg-cyan-100', text: 'text-cyan-800', border: 'border-cyan-400', progress: 'bg-cyan-500' }, indigo: { bg: 'bg-indigo-100', text: 'text-indigo-800', border: 'border-indigo-400', progress: 'bg-indigo-500' }, slate: { bg: 'bg-slate-100', text: 'text-slate-800', border: 'border-slate-400', progress: 'bg-slate-500' }, fuchsia: { bg: 'bg-fuchsia-100', text: 'text-fuchsia-800', border: 'border-fuchsia-400', progress: 'bg-fuchsia-500' }, stone: { bg: 'bg-stone-100', text: 'text-stone-800', border: 'border-stone-400', progress: 'bg-stone-500' }};

        // --- Fungsi-fungsi Aplikasi ---

        function createNewUser(name, avatarId) {
            const starterAvatars = Object.keys(avatarData).filter(id => avatarData[id].isStarter);
            const u = {
                id: Date.now(),
                name: name,
                avatarId: avatarId,
                jenjang: null,
                points: 0,
                progress: {},
                badges: {},
                dailyMission: {},
                lastLogin: null,
                loginStreak: 0,
                studyStreak: 0,
                lastStudyDate: null,
                unlockedAvatars: starterAvatars,
                stats: { correctAnswers: 0, wrongAnswers: 0, quizzesCompleted: 0, proQuizzesCompleted: 0 },
                settings: { soundOn: true, theme: 'light', musicOn: false, fontSize: 'normal', zenMode: false, soundPack: 'default' },
                title: "Petualang Baru",
                unlockedTitles: ["Petualang Baru"],
                achievementProgress: {},
                inventory: {},
                favorites: [],
                notes: {},
                equippedMascot: [],
            };
            userProfiles.push(u);
            currentUserIndex = userProfiles.length - 1;
            activeUser = u;
            saveData();
            domElements.jenjangPromptName.textContent = `Hai ${activeUser.name}, ayo pilih jenjangmu!`;
            switchScreen('jenjang-screen');
        }

        function checkDailyLogin() {
            const today = new Date();
            const todayStr = today.toDateString();
            if (activeUser.lastLogin === todayStr) return;

            const yesterday = new Date(today);
            yesterday.setDate(today.getDate() - 1);
            
            if (activeUser.lastLogin === yesterday.toDateString()) {
                activeUser.loginStreak++;
            } else if (activeUser.lastLogin !== null) {
                activeUser.loginStreak = 1;
                 showMascotTip(`Semangat kembali, ${activeUser.name}! Lanjutkan petualanganmu setiap hari untuk bonus lebih besar!`);
            } else {
                 activeUser.loginStreak = 1;
            }
            
            const baseBonus = 50;
            const streakBonus = activeUser.loginStreak * 10;
            const totalBonus = baseBonus + streakBonus;

            activeUser.lastLogin = todayStr;
            addPoints(totalBonus, null, false);
            
            domElements.dailyBonusAmount.textContent = `${totalBonus} Poin`;
            if (activeUser.loginStreak > 1) {
                domElements.dailyStreakBonusText.textContent = `Bonus beruntun ${activeUser.loginStreak} hari: +${streakBonus} poin!`;
            } else {
                domElements.dailyStreakBonusText.textContent = "Selesaikan misimu dan kembali besok untuk bonus lebih besar!";
            }

            saveData();
            updateUI();
            showModal('daily-bonus-modal');
        }

        function updateUI() {
            if (!activeUser) return;
            document.body.classList.toggle('zen-mode', activeUser.settings.zenMode);
            domElements.welcomeMessage.textContent = `Halo, ${activeUser.name}!`;
            domElements.userTitleDisplay.textContent = activeUser.title;
            domElements.userAvatarHeader.innerHTML = avatarData[activeUser.avatarId].svg;
            domElements.streakDisplay.innerHTML = activeUser.loginStreak > 1 ? `ğŸ”¥ ${activeUser.loginStreak}` : '';
            domElements.pointsDisplay.textContent = `ğŸ’° Poin: ${activeUser.points}`;
            setWordOfTheDay();
            checkGlobalEvents();
        }
        
        function showPointAnimation(text) {
            const animEl = document.createElement('div');
            animEl.className = 'point-animation';
            animEl.textContent = text;
            domElements.pointAnimationContainer.appendChild(animEl);
            setTimeout(() => {
                animEl.remove();
            }, 1500);
        }

        function addPoints(amount, duniaId = null, withAnimation = true) {
            if (!activeUser || activeUser.settings.zenMode) return;
            let finalAmount = amount;
            
            const activeEvent = getActiveEvent();
            if (activeEvent && activeEvent.dunia.includes(duniaId)) {
                finalAmount *= activeEvent.multiplier;
            }

            if (duniaId && duniaId === dailyBonusWorldId && amount > 0) {
                finalAmount = Math.ceil(finalAmount * 1.25); // Bonus 25%
            }
            activeUser.points += Math.round(finalAmount);
            if(withAnimation && finalAmount > 0) showPointAnimation(`+${Math.round(finalAmount)}`);
            saveData();
            updateUI();
        }

        function renderAvatarShop() {
            domElements.shopPointsDisplay.textContent = `ğŸ’° Poin Anda: ${activeUser.points}`;
            domElements.avatarShopContainer.innerHTML = '';
            Object.keys(avatarData).forEach(avatarId => {
                const avatar = avatarData[avatarId];
                const isOwned = activeUser.unlockedAvatars.includes(avatarId);
                const isEquipped = activeUser.avatarId === avatarId;
                
                const item = document.createElement('div');
                item.className = 'shop-item p-4 flex flex-col items-center justify-center';
                if (isOwned) item.classList.add('owned');
                if (isEquipped) item.classList.add('equipped');

                item.innerHTML = avatar.svg;

                if (!isOwned) {
                    item.classList.add('locked');
                    item.innerHTML += `<div class="price-tag">ğŸ’° ${avatar.price}</div>`;
                }
                
                item.addEventListener('click', () => {
                    if (isOwned) {
                        playSound('equip');
                        activeUser.avatarId = avatarId;
                        saveData();
                        updateUI();
                        renderAvatarShop();
                    } else {
                        if (activeUser.points >= avatar.price) {
                            playSound('purchase');
                            addPoints(-avatar.price, null, false);
                            activeUser.unlockedAvatars.push(avatarId);
                            saveData();
                            updateUI();
                            renderAvatarShop();
                        } else {
                            playSound('wrong');
                            showMascotTip("Duh, poinmu belum cukup untuk membeli avatar ini. Ayo selesaikan lebih banyak kuis!");
                        }
                    }
                });
                domElements.avatarShopContainer.appendChild(item);
            });
        }
        
        function handleQuizAnswer(element, answer, duniaId, submateriId, type, hintUsed) {
            const feedbackEl = document.getElementById('quiz-feedback');
            const isCompleted = activeUser.progress[activeUser.jenjang]?.[duniaId]?.[submateriId];

            let userAnswer;
            if (type === 'isi-jawaban') {
                userAnswer = element.value.trim();
            } else {
                userAnswer = element.textContent.trim();
            }

            const isCorrect = userAnswer.toLowerCase() === answer.toLowerCase();

            if (isCorrect) {
                playSound('correct');
                feedbackEl.textContent = 'Jawaban Benar! Kamu Hebat!';
                feedbackEl.className = 'mt-4 text-lg font-bold text-green-600';
                activeUser.stats.correctAnswers++;
                
                const todayStr = new Date().toDateString();
                if(activeUser.lastStudyDate !== todayStr) {
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    if(activeUser.lastStudyDate === yesterday.toDateString()){
                        activeUser.studyStreak++;
                    } else {
                        activeUser.studyStreak = 1;
                    }
                    activeUser.lastStudyDate = todayStr;
                    if(activeUser.studyStreak > 1) showMascotTip(`Runtutan belajar ${activeUser.studyStreak} hari! Keren!`);
                }


                if (!isCompleted) {
                    const pointsEarned = hintUsed ? 5 : 10;
                    addPoints(pointsEarned, duniaId);
                    activeUser.progress[activeUser.jenjang][duniaId][submateriId] = { done: true };
                    activeUser.stats.quizzesCompleted++;
                    updateDailyMissionProgress('quiz_completed', duniaId);
                    updateDailyMissionProgress('correct_answer');
                    checkAndAwardBadges();
                    saveData();
                }

                setTimeout(() => {
                    const materi = edukasiData[activeUser.jenjang].dunia[duniaId].subMateri[submateriId];
                    if (materi.funFact) {
                        document.getElementById('mascot-container').innerHTML = mascotSVG;
                        domElements.funFactText.textContent = materi.funFact;
                        showModal('fun-fact-modal');
                    } else {
                        renderSubMateri(duniaId);
                        switchScreen('submateri-screen');
                    }
                }, 1000);

            } else {
                playSound('wrong');
                activeUser.stats.wrongAnswers++;
                feedbackEl.textContent = 'Jawaban kurang tepat, coba lagi!';
                feedbackEl.className = 'mt-4 text-lg font-bold text-red-600';
                if (element.classList) {
                    element.classList.add('animate-shake');
                    setTimeout(() => element.classList.remove('animate-shake'), 500);
                }
                
                setTimeout(() => {
                    feedbackEl.textContent = `Jawaban yang benar adalah: ${answer}`;
                    domElements.materiContent.querySelectorAll('.quiz-option').forEach(btn => {
                        if (btn.textContent.trim().toLowerCase() === answer.toLowerCase()) {
                             btn.classList.add('bg-green-200', 'border-green-500');
                        }
                    });
                }, 1500);
            }

            domElements.materiContent.querySelectorAll('.quiz-option, #quiz-submit-btn, .hint-button').forEach(btn => btn.disabled = true);
        }
        
        function initializeApp() {
            setTimeout(() => {
                if (loadData()) { renderUserSelectionScreen(); } else { switchScreen('user-selection-screen'); setupNewUserScreen(); showMascotTip("Selamat datang di Petualangan Pengetahuan! Buat profil barumu untuk memulai."); }
            }, 500);
        }

        // --- Inisialisasi & Fungsi Helper ---
        function playSound(type) { if(!activeUser?.settings?.soundOn) return; Tone.start().catch(e=>console.log("Tone.js not started.")); try { if (type === 'correct') sounds.correct.triggerAttackRelease("C5", "8n"); else if (type === 'wrong') sounds.wrong.triggerAttackRelease("C3", "8n"); else if (type === 'badge') { sounds.badge.triggerAttackRelease("G4", "8n", Tone.now()); sounds.badge.triggerAttackRelease("C5", "8n", Tone.now() + 0.2); sounds.badge.triggerAttackRelease("E5", "8n", Tone.now() + 0.4); } else if (type === 'open') { sounds.open.triggerAttackRelease("A4", "16n"); } else if (type === 'purchase') { sounds.purchase.triggerAttackRelease("E5", "8n"); } else if (type === 'equip') { sounds.equip.triggerAttackRelease("C5", "4n"); } else sounds.click.triggerAttackRelease("C4", "8n"); } catch (e) { console.error("Sound play error:", e); } }
        function speak(text, lang = 'id-ID') { if ('speechSynthesis' in window) { speechSynthesis.cancel(); const utterance = new SpeechSynthesisUtterance(text); utterance.lang = lang; utterance.rate = 0.9; speechSynthesis.speak(utterance); } }
        function saveData() { if (currentUserIndex > -1) userProfiles[currentUserIndex] = activeUser; localStorage.setItem('petualanganPenggunaEkspansi', JSON.stringify(userProfiles)); }
        function loadData() { const d = localStorage.getItem('petualanganPenggunaEkspansi'); if (d) { userProfiles = JSON.parse(d); return userProfiles.length > 0; } return false; }
        function selectUser(idx) { currentUserIndex = idx; activeUser = userProfiles[idx]; if (!activeUser.jenjang) { domElements.jenjangPromptName.textContent = `Hai ${activeUser.name}, ayo pilih jenjangmu!`; switchScreen('jenjang-screen'); } else { applySettings(); startSession(); } }
        function initializeProgressForJenjang(jenjang) { if (!edukasiData[jenjang] || !activeUser) return; if (!activeUser.progress) activeUser.progress = {}; if (!activeUser.badges) activeUser.badges = {}; if(!activeUser.stats) activeUser.stats = { correctAnswers: 0, wrongAnswers: 0, quizzesCompleted: 0 }; if (activeUser.progress[jenjang]) return; activeUser.progress[jenjang] = {}; activeUser.badges[jenjang] = []; for (const duniaId in edukasiData[jenjang].dunia) { activeUser.progress[jenjang][duniaId] = {}; for (const submateriId in edukasiData[jenjang].dunia[duniaId].subMateri) { activeUser.progress[jenjang][duniaId][submateriId] = { done: false }; } } saveData(); }
        function switchScreen(id) { domElements.screens.forEach(s => s.classList.remove('active')); document.getElementById(id).classList.add('active'); }
        function showModal(id) { playSound('open'); document.getElementById(id).classList.add('active'); }
        function hideModals() { domElements.modals.forEach(m => m.classList.remove('active')); }
        function startSession() { checkDailyLogin(); checkDailyMission(); setDailyBonusWorld(); updateUI(); renderDuniaMap(); switchScreen('map-screen'); }
        function applySettings() { document.body.className = ''; document.body.classList.add(activeUser.settings.theme); document.body.classList.add(`font-size-${activeUser.settings.fontSize}`); toggleMusic(activeUser.settings.musicOn); }
        function renderUserSelectionScreen() { domElements.userListContainer.innerHTML = ''; userProfiles.forEach((user, index) => { const jenjangText = user.jenjang ? {sd: "SD", smp: "SMP", sma: "SMA", kuliah: "Kuliah"}[user.jenjang] : 'Baru'; const card = document.createElement('div'); card.className = 'user-card p-4 bg-white rounded-2xl shadow-lg text-center cursor-pointer card-hover'; const avatarHTML = avatarData[user.avatarId]?.svg || `<div class="avatar mx-auto mb-4 bg-gray-400 font-brand text-3xl">${user.name.charAt(0).toUpperCase()}</div>`; card.innerHTML = `${avatarHTML}<h3 class="font-bold text-xl">${user.name}</h3><p class="text-gray-500">${jenjangText} - ${user.points} Poin</p>`; card.addEventListener('click', () => { playSound('click'); selectUser(index); }); domElements.userListContainer.appendChild(card); }); switchScreen('user-selection-screen'); }
        function renderDuniaMap(filter = '') { const jenjang = activeUser.jenjang; const dataDunia = edukasiData[jenjang].dunia; domElements.duniaContainer.innerHTML = ''; 
            for (const duniaId in dataDunia) { const dunia = dataDunia[duniaId]; 
            if (filter && !dunia.namaDunia.toLowerCase().includes(filter.toLowerCase())) continue;
            const c = colorMapping[dunia.warna] || colorMapping.blue; const progress = activeUser.progress[jenjang]?.[duniaId] || {}; const total = Object.keys(dunia.subMateri).length; const completed = Object.values(progress).filter(p => p.done).length; const percentage = total > 0 ? (completed / total) * 100 : 0; const card = document.createElement('div'); card.className = `p-6 rounded-2xl shadow-lg cursor-pointer card-hover border-4 ${c.border} flex flex-col relative`; card.style.backgroundColor = `var(--card-bg-color)`;
            let bonusBadge = '';
            if (duniaId === dailyBonusWorldId) {
                bonusBadge = '<div class="bonus-world-badge">BONUS!</div>';
            }
            card.innerHTML = `${bonusBadge}<div class="text-5xl text-center mb-4">${dunia.icon}</div><h3 class="font-brand text-2xl text-center ${c.text}">${dunia.namaDunia}</h3><p class="text-sm mt-2 text-center flex-grow min-h-[60px]">${dunia.deskripsi}</p><div class="mt-4"><div class="text-xs font-semibold text-center mb-1">${completed} / ${total} Selesai</div><div class="w-full bg-gray-200 rounded-full h-2.5"><div class="${c.progress} h-2.5 rounded-full" style="width: ${percentage}%;"></div></div></div>`; card.addEventListener('click', () => { playSound('click'); currentDuniaId = duniaId; renderSubMateri(duniaId); switchScreen('submateri-screen'); }); domElements.duniaContainer.appendChild(card); } }
        function renderSubMateri(duniaId) { 
            const dunia = edukasiData[activeUser.jenjang].dunia[duniaId];
            const useTreeView = domElements.progressTreeToggle.checked;
            const colors = colorMapping[dunia.warna]; domElements.submateriTitle.textContent = dunia.namaDunia; domElements.submateriTitle.className = `font-brand text-4xl md:text-5xl text-center ${colors.text}`; domElements.submateriContainer.innerHTML = '';
            let prevSubmateriId = null; 
            for (const submateriId in dunia.subMateri) { const submateri = dunia.subMateri[submateriId]; const isCompleted = activeUser.progress[activeUser.jenjang]?.[duniaId]?.[submateriId]?.done;
                let isLocked = false;
                if(useTreeView) {
                    const prevIsCompleted = prevSubmateriId ? activeUser.progress[activeUser.jenjang]?.[duniaId]?.[prevSubmateriId]?.done : true;
                    if(!prevIsCompleted) isLocked = true;
                }

                const card = document.createElement('div'); card.className = `p-5 rounded-xl shadow-md flex items-center justify-between border-2 ${colors.border} ${isLocked ? 'opacity-50 cursor-not-allowed' : 'cursor-pointer card-hover'}`;
                card.innerHTML = `<span class="font-semibold ${colors.text}">${submateri.judul}</span> ${isCompleted ? `<span class="text-2xl text-yellow-500 star-animation">â­</span>` : (isLocked ? `<span>ğŸ”’</span>` : `<span class="w-6 h-6 rounded-full border-2 ${colors.border}"></span>`)}`; 
                if(!isLocked) {
                    card.addEventListener('click', () => { playSound('click'); currentSubmateriId = submateriId; renderMateri(duniaId, submateriId); switchScreen('materi-screen'); });
                }
                domElements.submateriContainer.appendChild(card);
                prevSubmateriId = submateriId;
            } }
        function renderMateri(duniaId, submateriId) { 
            const materi = edukasiData[activeUser.jenjang].dunia[duniaId].subMateri[submateriId];
            const colors = colorMapping[edukasiData[activeUser.jenjang].dunia[duniaId].warna]; 
            if(!materi || !materi.kuis || !materi.kuis[0]){ domElements.materiContent.innerHTML = `<h2 class="font-brand text-3xl ${colors.text} mb-4">Materi Belum Tersedia</h2><p>Konten untuk materi ini sedang dalam pengembangan. Silakan kembali lagi nanti!</p>`; return; } 
            
            const quiz = materi.kuis[0]; 
            let hintUsed = false;
            let optionsHTML = ''; if (quiz.type === 'pilihan-ganda') { const shuffled = [...quiz.pilihan].sort(() => .5 - Math.random()); shuffled.forEach(o => { optionsHTML += `<button class="quiz-option w-full text-left p-4 my-2 border-2 ${colors.border} rounded-lg hover:${colors.bg} font-semibold">${o}</button>`; }); } else if (quiz.type === 'benar-salah') { optionsHTML += `<button class="quiz-option w-full text-left p-4 my-2 border-2 ${colors.border} rounded-lg hover:${colors.bg} font-semibold">Benar</button><button class="quiz-option w-full text-left p-4 my-2 border-2 ${colors.border} rounded-lg hover:${colors.bg} font-semibold">Salah</button>`; } else if (quiz.type === 'isi-jawaban') { optionsHTML = `<div class="flex gap-2 items-center"><input type="text" id="quiz-input-text" placeholder="Ketik jawabanmu..." class="w-full p-3 border-2 ${colors.border} rounded-lg"><button id="quiz-submit-btn" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-5 rounded-lg">Jawab</button></div>`; } 
            
            let hintButtonHTML = '';
            if(quiz.hint){
                hintButtonHTML = `<button class="hint-button rounded-full p-2" title="Gunakan 5 Poin untuk Petunjuk"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg></button>`;
            }
            
            domElements.materiContent.innerHTML = `<h2 class="font-brand text-3xl md:text-4xl ${colors.text} mb-4 flex items-center justify-between">${materi.judul}<span class="tts-button rounded-full p-2" title="Dengarkan materi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg></span></h2><div class="prose max-w-none text-lg leading-relaxed">${materi.konten}</div><hr class="my-6 border-t-2 ${colors.border}"><div class="flex items-center justify-between"><h3 class="font-bold text-xl mb-3">Tantangan Cepat!</h3>${hintButtonHTML}</div><p class="mb-4 text-lg">${quiz.pertanyaan}</p><div id="quiz-options">${optionsHTML}</div><div id="quiz-feedback" class="mt-4 text-lg font-bold"></div>`; 
            domElements.materiContent.querySelector('.tts-button').addEventListener('click', () => speak(`${materi.judul}. ${domElements.materiContent.querySelector('.prose').textContent}`)); 
            
            const hintBtn = domElements.materiContent.querySelector('.hint-button');
            if (hintBtn) {
                hintBtn.addEventListener('click', () => {
                    if (activeUser.points >= 5) {
                        addPoints(-5, null, false);
                        showMascotTip(`Ini petunjuknya: "${quiz.hint}"`);
                        hintUsed = true;
                        hintBtn.disabled = true;
                        hintBtn.classList.add('opacity-50');
                    } else {
                        playSound('wrong');
                        showMascotTip("Poinmu tidak cukup untuk menggunakan petunjuk!");
                    }
                });
            }

          if(quiz.type === 'isi-jawaban'){ document.getElementById('quiz-submit-btn').addEventListener('click', (e) => handleQuizAnswer(document.getElementById('quiz-input-text'), quiz.jawaban, duniaId, submateriId, quiz.type, hintUsed)); document.getElementById('quiz-input-text').addEventListener('keyup', e => { if (e.key === 'Enter') handleQuizAnswer(e.target, quiz.jawaban, duniaId, submateriId, quiz.type, hintUsed); }); } else { domElements.materiContent.querySelectorAll('.quiz-option').forEach(b => b.addEventListener('click', (e) => handleQuizAnswer(e.target, quiz.jawaban, duniaId, submateriId, quiz.type, hintUsed))); } }
        function checkAndAwardBadges() { const jenjang = activeUser.jenjang; const dataDunia = edukasiData[jenjang].dunia; if(!activeUser.badges[jenjang]) activeUser.badges[jenjang] = []; const userBadges = activeUser.badges[jenjang]; let newBadgeEarned = false; for (const duniaId in dataDunia) { if (userBadges.includes(duniaId)) continue; const progress = activeUser.progress[jenjang]?.[duniaId] || {}; const total = Object.keys(dataDunia[duniaId].subMateri).length; const completed = Object.values(progress).filter(p => p.done).length; if (total > 0 && completed === total) { userBadges.push(duniaId); newBadgeEarned = true; showMascotTip(`Luar biasa! Kamu telah menguasai ${dataDunia[duniaId].namaDunia} dan mendapatkan lencana baru!`); } } const allWorldsDone = Object.keys(dataDunia).every(duniaId => userBadges.includes(duniaId)); if (allWorldsDone && !userBadges.includes('cendekia')) { userBadges.push('cendekia'); newBadgeEarned = true; setTimeout(() => { hideModals(); domElements.certificateName.textContent = activeUser.name; showModal('certificate-modal'); }, 1500); } if (newBadgeEarned) { playSound('badge'); saveData(); } }
        function renderAchievements() { const jenjang = activeUser.jenjang; if (!edukasiData[jenjang]) return; const badgesDef = edukasiData[jenjang].badges; const userBadges = activeUser.badges[jenjang] || []; domElements.achievementsList.innerHTML = ''; if (!badgesDef || Object.keys(badgesDef).length === 0) { domElements.achievementsList.innerHTML = '<p>Lencana untuk jenjang ini belum tersedia.</p>'; return; } Object.keys(badgesDef).forEach(badgeId => { const badge = badgesDef[badgeId]; const hasBadge = userBadges.includes(badge.id); const badgeEl = document.createElement('div'); badgeEl.className = `badge flex items-center p-3 rounded-lg border-2 ${hasBadge ? 'border-amber-400 bg-amber-50' : 'border-gray-300 opacity-60'}`; badgeEl.innerHTML = `<div class="text-4xl mr-4 ${hasBadge ? '' : 'filter grayscale'}">${badge.icon}</div><div><h4 class="font-bold text-lg ${hasBadge ? 'text-amber-700' : ''}">${badge.title}</h4><p class="text-sm ${hasBadge ? 'text-amber-600' : ''}">${badge.description}</p></div>`; domElements.achievementsList.appendChild(badgeEl); }); }
        function renderLeaderboard() { domElements.leaderboardList.innerHTML = ''; const sortedUsers = [...userProfiles].sort((a, b) => b.points - a.points); sortedUsers.forEach((user, index) => { const rank = index + 1; const medal = rank === 1 ? 'ğŸ¥‡' : rank === 2 ? 'ğŸ¥ˆ' : rank === 3 ? 'ğŸ¥‰' : `#${rank}`; const isCurrentUser = user.id === activeUser.id; const row = document.createElement('div'); row.className = `flex items-center justify-between p-3 rounded-lg cursor-pointer hover:bg-gray-100 ${isCurrentUser ? 'bg-blue-100 border-2 border-blue-400' : 'bg-gray-50'}`; row.innerHTML = `<div class="flex items-center gap-3"><span class="font-bold text-lg w-8 text-center">${medal}</span><span class="font-semibold">${user.name}</span></div><span class="font-bold text-amber-600">${user.points} Poin</span>`; row.addEventListener('click', () => { viewedUser = user; renderStatsPage(user); }); domElements.leaderboardList.appendChild(row); }); }
        function checkDailyMission() { const today = new Date().toDateString(); if (!activeUser.dailyMission || activeUser.dailyMission.date !== today) { generateNewDailyMission(); } }
        function updateDailyMissionProgress(type, detail) { const mission = activeUser.dailyMission; if (mission.claimed || mission.current >= mission.target) return; if(mission.type === type || (mission.type === 'quiz_completed_any' && type === 'quiz_completed') || (mission.type === 'quiz_completed_subject' && type === 'quiz_completed' && edukasiData[activeUser.jenjang].dunia[detail]?.namaDunia.toLowerCase().includes(mission.detail.toLowerCase()) ) ) { mission.current++; } saveData(); }
        function renderDailyMission() { const mission = activeUser.dailyMission; domElements.dailyMissionText.textContent = mission.description; const progress = (mission.current / mission.target) * 100; domElements.missionProgressBar.style.width = `${progress}%`; domElements.missionProgressBar.textContent = `${Math.floor(progress)}%`; if (mission.current >= mission.target && !mission.claimed) { domElements.claimMissionRewardBtn.disabled = false; domElements.claimMissionRewardBtn.textContent = `Klaim Hadiah (${mission.reward} Poin)!`; } else if (mission.claimed) { domElements.claimMissionRewardBtn.disabled = true; domElements.claimMissionRewardBtn.textContent = 'Hadiah Sudah Diklaim'; } else { domElements.claimMissionRewardBtn.disabled = true; domElements.claimMissionRewardBtn.textContent = `Selesaikan ${mission.target - mission.current} lagi`; } }
        function setupNewUserScreen() { domElements.avatarSelectionContainer.innerHTML = ''; Object.keys(avatarData).filter(id => avatarData[id].isStarter).forEach(avatarId => { const avatarEl = document.createElement('div'); avatarEl.className = 'avatar-selection w-20 h-20 p-1'; avatarEl.dataset.avatarId = avatarId; avatarEl.innerHTML = avatarData[avatarId].svg; avatarEl.addEventListener('click', () => { document.querySelectorAll('.avatar-selection').forEach(el => el.classList.remove('selected')); avatarEl.classList.add('selected'); selectedAvatarId = avatarId; validateNewUserInput(); }); domElements.avatarSelectionContainer.appendChild(avatarEl); }); domElements.playerNameInput.value = ''; selectedAvatarId = null; validateNewUserInput(); switchScreen('name-entry-screen'); }
        function validateNewUserInput() { const name = domElements.playerNameInput.value.trim(); if (name && selectedAvatarId) { domElements.nextToLevelBtn.disabled = false; } else { domElements.nextToLevelBtn.disabled = true; } }
        function showMascotTip(message) { domElements.mascotTipContainer.innerHTML = ''; const tipEl = document.createElement('div'); tipEl.className = 'mascot-tip'; tipEl.innerHTML = `<div class="w-12 h-12 mr-3">${mascotSVG}</div><p class="text-sm">${message}</p>`; domElements.mascotTipContainer.appendChild(tipEl); setTimeout(() => { tipEl.remove(); }, 6000); }
        function toggleMusic(forceState) { let musicOn = forceState ?? !activeUser.settings.musicOn; if(musicOn){ domElements.backgroundMusic.play().catch(e=>console.log("Autoplay blocked")); domElements.musicToggleBtn.textContent = 'ğŸµ'; } else { domElements.backgroundMusic.pause(); domElements.musicToggleBtn.textContent = 'ğŸ¶'; } activeUser.settings.musicOn = musicOn; saveData(); }
        function setWordOfTheDay() { const words = [ {kata: "Edukasi", arti: "Proses pembelajaran atau pemerolehan pengetahuan."}, {kata: "Inovasi", arti: "Penemuan baru atau pembaruan yang bermanfaat."}, {kata: "Kolaborasi", arti: "Kerja sama untuk mencapai tujuan bersama."}, {kata: "Literasi", arti: "Kemampuan membaca dan menulis."}, {kata: "Kompeten", arti: "Cakap atau memiliki kemampuan yang diperlukan."} ]; const dayIndex = new Date().getDate() % words.length; domElements.wordOfTheDay.innerHTML = `<strong>${words[dayIndex].kata}:</strong> ${words[dayIndex].arti}`; }
        function generateNewDailyMission() { const missions = [ { type: 'quiz_completed_any', description: (t) => `Selesaikan ${t} kuis hari ini.`, target: 3, reward: 25 }, { type: 'correct_answer', description: (t) => `Jawab ${t} pertanyaan dengan benar.`, target: 5, reward: 30 }, { type: 'quiz_completed_subject', description: (t, d) => `Selesaikan ${t} kuis di dunia ${d}.`, target: 2, reward: 40, detail: "Angka" }, { type: 'quiz_completed_subject', description: (t, d) => `Selesaikan ${t} kuis di dunia ${d}.`, target: 1, reward: 20, detail: "Sains" } ]; const mission = missions[Math.floor(Math.random() * missions.length)]; activeUser.dailyMission = { date: new Date().toDateString(), type: mission.type, description: mission.description(mission.target, mission.detail), target: mission.target, current: 0, reward: mission.reward, detail: mission.detail, claimed: false }; saveData(); }
        function startTimedChallenge() { playSound('open'); showModal('timed-challenge-modal'); let timeLeft = 60; let score = 0; let questions = []; let currentQuestionIndex = 0;
            const allQuizzes = Object.values(edukasiData[activeUser.jenjang].dunia).flatMap(dunia => Object.values(dunia.subMateri).map(sm => sm.kuis[0])).filter(q => q);
            questions = [...allQuizzes].sort(() => 0.5 - Math.random()).slice(0, 10);
            
            function renderChallengeQuestion() {
                if (currentQuestionIndex >= questions.length) { endChallenge(); return; }
                const quiz = questions[currentQuestionIndex];
                let optionsHTML = '';
                quiz.pilihan.forEach(o => { optionsHTML += `<button class="challenge-option w-full text-left p-3 my-2 border-2 border-gray-300 rounded-lg hover:bg-gray-100">${o}</button>`; });
                domElements.challengeQuestionArea.innerHTML = `<p class="font-bold text-lg mb-3">${quiz.pertanyaan}</p>${optionsHTML}`;
                domElements.challengeQuestionArea.querySelectorAll('.challenge-option').forEach(btn => {
                    btn.addEventListener('click', e => {
                        if (e.target.textContent === quiz.jawaban) {
                            score++;
                            domElements.challengeFeedback.textContent = "Benar!";
                            domElements.challengeFeedback.className = 'mt-4 font-bold text-green-600';
                        } else {
                            domElements.challengeFeedback.textContent = "Salah!";
                             domElements.challengeFeedback.className = 'mt-4 font-bold text-red-600';
                        }
                        currentQuestionIndex++;
                        setTimeout(() => { domElements.challengeFeedback.textContent = ''; renderChallengeQuestion(); }, 500);
                    });
                });
            }

            function endChallenge() { clearInterval(timedChallengeInterval); domElements.challengeQuestionArea.innerHTML = `<h4 class="font-bold text-2xl">Waktu Habis!</h4><p class="text-lg mt-2">Skor Anda: ${score} / ${currentQuestionIndex}</p><p class="text-lg mt-1">Anda mendapatkan ${score * 5} Poin Bonus!</p>`; addPoints(score * 5); domElements.closeTimedChallengeBtn.classList.remove('hidden'); }
            
            timedChallengeInterval = setInterval(() => {
                timeLeft--;
                domElements.challengeTimer.textContent = `Sisa Waktu: ${timeLeft} detik`;
                if (timeLeft <= 0) endChallenge();
            }, 1000);

            domElements.challengeQuestionArea.innerHTML = '';
            domElements.challengeFeedback.textContent = '';
            domElements.closeTimedChallengeBtn.classList.add('hidden');
            renderChallengeQuestion();
        }
        function renderStatsPage(user) { hideModals(); domElements.statsUsername.textContent = `Statistik ${user.name}`; 
            const jenjang = user.jenjang; const badges = jenjang ? edukasiData[jenjang].badges : {}; const userBadges = user.badges[jenjang] || [];
            domElements.statsContent.innerHTML = `
                <div class="p-3 bg-amber-50 rounded-lg flex justify-between items-center"><strong>Poin:</strong> <span class="font-bold text-amber-700">${user.points}</span></div>
                <div class="p-3 bg-green-50 rounded-lg flex justify-between items-center"><strong>Kuis Selesai:</strong> <span class="font-bold text-green-700">${user.stats.quizzesCompleted || 0}</span></div>
                <div class="p-3 bg-sky-50 rounded-lg flex justify-between items-center"><strong>Lencana Didapat:</strong> <span class="font-bold text-sky-700">${userBadges.length} / ${Object.keys(badges).length}</span></div>
                <div class="p-3 bg-red-50 rounded-lg flex justify-between items-center"><strong>Login Beruntun:</strong> <span class="font-bold text-red-700">${user.loginStreak || 0} Hari</span></div>
            `;
            showModal('stats-modal'); 
        }

        function setDailyBonusWorld() {
            const jenjang = activeUser.jenjang;
            const allDuniaIds = Object.keys(edukasiData[jenjang].dunia);
            const dayIndex = new Date().getDate() % allDuniaIds.length;
            dailyBonusWorldId = allDuniaIds[dayIndex];
        }
        
        function openGenericShop(shopId) {
            hideModals();
            const shop = shopData[shopId];
            if (!shop) return;
            domElements.genericShopTitle.textContent = shop.title;
            domElements.genericShopPoints.textContent = `ğŸ’° Poin: ${activeUser.points}`;
            const container = domElements.genericShopContainer;
            container.innerHTML = '';

            for (const itemId in shop.items) {
                const item = shop.items[itemId];
                const itemEl = document.createElement('div');
                itemEl.className = 'p-4 border rounded-lg flex flex-col items-center text-center';
                itemEl.innerHTML = `
                    <div class="text-4xl mb-2">${item.icon}</div>
                    <div class="font-bold">${item.name}</div>
                    <div class="text-sm text-amber-700 font-semibold my-1">${item.price} Poin</div>
                    <button class="buy-item-btn mt-2 bg-green-500 hover:bg-green-600 text-white px-4 py-1 rounded-full text-sm font-bold" data-shop-id="${shopId}" data-item-id="${itemId}">Beli</button>
                `;
                container.appendChild(itemEl);
            }
            showModal('generic-shop-modal');
        }

        function getActiveEvent() {
            const now = new Date();
            const day = now.getDay(); // 0 = Minggu, 6 = Sabtu
            const events = [
                { name: "Pekan Sains", dunia: ["ipa_sd", "biologi_smp", "fisika_sma"], multiplier: 2, days: [5, 6, 0] }, // Jumat, Sabtu, Minggu
                { name: "Festival Sejarah", dunia: ["pahlawan_sd", "ips_smp", "sejarah_dunia_sma"], multiplier: 1.5, days: [1, 2] } // Senin, Selasa
            ];
            return events.find(e => e.days.includes(day));
        }

        function checkGlobalEvents() {
            const event = getActiveEvent();
            if (event) {
                domElements.eventBannerContainer.innerHTML = `<div class="p-3 rounded-lg text-center font-bold event-banner">ğŸ‰ EVENT: ${event.name}! Dapatkan ${event.multiplier}x Poin di Dunia Terkait! ğŸ‰</div>`;
            } else {
                domElements.eventBannerContainer.innerHTML = '';
            }
        }
        
        // --- Event Listeners ---
        domElements.addNewUserBtn.addEventListener('click', () => { playSound('click'); setupNewUserScreen(); });
        domElements.cancelNewUserBtn.addEventListener('click', () => { playSound('click'); if (userProfiles.length > 0) renderUserSelectionScreen(); else switchScreen('loading-screen'); });
        domElements.playerNameInput.addEventListener('input', validateNewUserInput);
        domElements.nextToLevelBtn.addEventListener('click', () => { const name = domElements.playerNameInput.value.trim(); if (name && selectedAvatarId) { playSound('click'); createNewUser(name, selectedAvatarId); } });
        document.querySelectorAll('.jenjang-btn').forEach(b => { b.addEventListener('click', (e) => { playSound('click'); activeUser.jenjang = e.currentTarget.dataset.jenjang; initializeProgressForJenjang(activeUser.jenjang); startSession(); }); });
        domElements.settingsBtn.addEventListener('click', () => { playSound('click'); domElements.editNameInput.value = activeUser.name; domElements.changeJenjangSelect.value = activeUser.jenjang; domElements.soundToggleBtn.textContent = activeUser.settings.soundOn ? 'ğŸ”Š' : 'ğŸ”‡'; domElements.musicToggleBtn.textContent = activeUser.settings.musicOn ? 'ğŸµ' : 'ğŸ¶'; applySettings(); showModal('settings-modal'); });
        document.querySelectorAll('.settings-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.settings-tab').forEach(t => t.classList.remove('border-sky-500', 'text-sky-600'));
                tab.classList.add('border-sky-500', 'text-sky-600');
                document.querySelectorAll('.settings-tab-pane').forEach(pane => pane.style.display = 'none');
                document.getElementById('tab-' + tab.dataset.tab).style.display = 'block';
            });
        });
        domElements.closeSettingsBtn.addEventListener('click', () => { playSound('click'); hideModals(); });
        domElements.saveNameBtn.addEventListener('click', () => { const newName = domElements.editNameInput.value.trim(); if (newName && newName !== activeUser.name) { playSound('correct'); activeUser.name = newName; saveData(); updateUI(); domElements.saveNameBtn.textContent = 'OK!'; setTimeout(() => { domElements.saveNameBtn.textContent = 'Simpan'; }, 1500); } });
        domElements.changeJenjangSelect.addEventListener('change', () => { const newJenjang = domElements.changeJenjangSelect.value; if (newJenjang !== activeUser.jenjang) { playSound('click'); activeUser.jenjang = newJenjang; initializeProgressForJenjang(newJenjang); saveData(); updateUI(); renderDuniaMap(); hideModals(); } });
        domElements.userAvatarHeader.addEventListener('click', () => { playSound('click'); hideModals(); renderUserSelectionScreen(); });
        domElements.resetProgressBtn.addEventListener('click', () => { playSound('click'); domElements.resetUsernameConfirm.textContent = activeUser.name; hideModals(); showModal('confirm-reset-modal'); });
        domElements.cancelResetBtn.addEventListener('click', () => { playSound('click'); hideModals(); showModal('settings-modal'); });
        domElements.confirmResetBtn.addEventListener('click', () => { playSound('wrong'); activeUser.points = 0; activeUser.progress = {}; activeUser.badges = {}; initializeProgressForJenjang(activeUser.jenjang); saveData(); hideModals(); startSession(); });
        domElements.backToWorldsBtn.addEventListener('click', () => { playSound('click'); renderDuniaMap(); switchScreen('map-screen'); });
        domElements.backToSubmateriBtn.addEventListener('click', () => { playSound('click'); renderSubMateri(currentDuniaId); switchScreen('submateri-screen'); });
        domElements.achievementsBtn.addEventListener('click', () => { playSound('click'); renderAchievements(); showModal('achievements-modal'); });
        domElements.closeAchievementsBtn.addEventListener('click', () => { playSound('click'); hideModals(); });
        domElements.closeFunFactBtn.addEventListener('click', () => { playSound('click'); hideModals(); renderSubMateri(currentDuniaId); switchScreen('submateri-screen'); });
        domElements.shareCertificateBtn.addEventListener('click', () => { const text = `Saya, ${activeUser.name}, telah meraih Sertifikat Petualang Pengetahuan! ğŸ“ğŸ‰`; navigator.clipboard.writeText(text).then(() => showMascotTip("Sertifikat disalin! Bagikan pencapaianmu!")); });
        domElements.closeCertificateBtn.addEventListener('click', () => { playSound('badge'); hideModals(); });
        domElements.leaderboardBtn.addEventListener('click', () => { playSound('click'); renderLeaderboard(); showModal('leaderboard-modal'); });
        domElements.closeLeaderboardBtn.addEventListener('click', () => { playSound('click'); hideModals(); });
        domElements.dailyMissionBtn.addEventListener('click', () => { playSound('click'); renderDailyMission(); showModal('daily-mission-modal'); });
        domElements.closeDailyMissionBtn.addEventListener('click', () => { playSound('click'); hideModals(); });
        domElements.claimMissionRewardBtn.addEventListener('click', () => { if (!activeUser.dailyMission.claimed && activeUser.dailyMission.current >= activeUser.dailyMission.target) { playSound('badge'); addPoints(activeUser.dailyMission.reward); activeUser.dailyMission.claimed = true; saveData(); updateUI(); renderDailyMission(); } });
        domElements.closeDailyBonusBtn.addEventListener('click', () => { playSound('click'); hideModals(); });
        domElements.soundToggleBtn.addEventListener('click', () => { activeUser.settings.soundOn = !activeUser.settings.soundOn; domElements.soundToggleBtn.textContent = activeUser.settings.soundOn ? 'ğŸ”Š' : 'ğŸ”‡'; saveData(); if(activeUser.settings.soundOn) playSound('click'); });
        domElements.themeSelector.addEventListener('click', e => { if(e.target.tagName === 'BUTTON') { playSound('click'); activeUser.settings.theme = e.target.dataset.theme; applySettings(); }});
        domElements.closeAvatarShopBtn.addEventListener('click', () => { playSound('click'); hideModals(); });
        domElements.shareProgressBtn.addEventListener('click', () => { const jenjang = {sd: "SD", smp: "SMP", sma: "SMA", kuliah: "Kuliah"}[activeUser.jenjang]; const badgeCount = activeUser.badges[activeUser.jenjang]?.length || 0; const text = `Saya telah mencapai ${activeUser.points} poin dan mendapatkan ${badgeCount} lencana di jenjang ${jenjang} dalam Petualangan Pengetahuan! ğŸš€ #BelajarSeru`; navigator.clipboard.writeText(text).then(() => showMascotTip("Prestasi disalin! Bagikan ke teman-temanmu!")); });
        domElements.musicToggleBtn.addEventListener('click', () => toggleMusic());
        domElements.searchBar.addEventListener('input', (e) => renderDuniaMap(e.target.value));
        domElements.timedChallengeBtn.addEventListener('click', startTimedChallenge);
        domElements.closeTimedChallengeBtn.addEventListener('click', () => hideModals());
        domElements.closeStatsBtn.addEventListener('click', () => { hideModals(); showModal('leaderboard-modal'); });
        domElements.progressTreeToggle.addEventListener('change', () => renderSubMateri(currentDuniaId));
        
        // Shop Hub Listeners
        document.getElementById('shop-hub-btn').addEventListener('click', () => { playSound('open'); showModal('shop-hub-modal'); });
        document.getElementById('close-shop-hub-btn').addEventListener('click', () => { playSound('click'); hideModals(); });
        document.getElementById('open-avatar-shop').addEventListener('click', () => { playSound('click'); hideModals(); renderAvatarShop(); showModal('avatar-shop-modal'); });
        document.getElementById('open-customization-shop').addEventListener('click', () => { playSound('click'); openGenericShop('customization'); });
        document.getElementById('open-powerup-shop').addEventListener('click', () => { playSound('click'); openGenericShop('powerup'); });
        document.getElementById('open-mascot-shop').addEventListener('click', () => { playSound('click'); openGenericShop('mascot'); });
        document.querySelectorAll('.generic-shop-close-btn').forEach(btn => btn.addEventListener('click', () => { playSound('click'); hideModals(); }));

        initializeApp();
    </script>
</body>
</html>